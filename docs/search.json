[{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/articles/cell_level_covariates.html","id":"standard-processing","dir":"Articles","previous_headings":"","what":"Standard processing","title":"Modeling continuous cell-level covariates","text":"code main vignette: many datasets, continuous cell-level variables mapped reads, gene count, mitochondrial rate, etc. continuous cell-level variables dataset, can simulate two normal distribution:","code":"library(dreamlet) library(muscat) library(ExperimentHub) library(scater)  # Download data, specifying EH2259 for the Kang, et al study eh <- ExperimentHub() sce <- eh[[\"EH2259\"]]  # only keep singlet cells with sufficient reads sce <- sce[rowSums(counts(sce) > 0) > 0, ] sce <- sce[,colData(sce)$multiplets == 'singlet']  # compute QC metrics qc <- perCellQCMetrics(sce)  # remove cells with few or many detected genes ol <- isOutlier(metric = qc$detected, nmads = 2, log = TRUE) sce <- sce[, !ol]  # set variable indicating stimulated (stim) or control (ctrl) sce$StimStatus = sce$stim sce$value1 = rnorm(ncol(sce)) sce$value2 = rnorm(ncol(sce))"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/articles/cell_level_covariates.html","id":"pseudobulk","dir":"Articles","previous_headings":"","what":"Pseudobulk","title":"Modeling continuous cell-level covariates","text":"Now compute pseudobulk using standard code: means per variable, cell type, sample stored pseudobulk SingleCellExperiment object:","code":"sce$id <- paste0(sce$StimStatus, sce$ind)  # Create pseudobulk  pb <- aggregateToPseudoBulk(sce,     assay = \"counts\",          cluster_id = \"cell\",       sample_id = \"id\",     verbose = FALSE) metadata(pb)$aggr_means ## # A tibble: 128 × 6 ## # Groups:   cell [8] ##    cell    id         ind cluster   value1   value2 ##    <fct>   <fct>    <dbl>   <dbl>    <dbl>    <dbl> ##  1 B cells ctrl101    101    3.96 -0.0262   0.0381  ##  2 B cells ctrl1015  1015    4.00 -0.0287  -0.0568  ##  3 B cells ctrl1016  1016    4    -0.00749  0.107   ##  4 B cells ctrl1039  1039    4.04 -0.0632  -0.0602  ##  5 B cells ctrl107    107    4     0.0431   0.0427  ##  6 B cells ctrl1244  1244    4    -0.0890   0.0552  ##  7 B cells ctrl1256  1256    4.01 -0.0648  -0.00655 ##  8 B cells ctrl1488  1488    4.02 -0.0439   0.00504 ##  9 B cells stim101    101    4.09 -0.0670   0.0421  ## 10 B cells stim1015  1015    4.06  0.120   -0.0476  ## # … with 118 more rows"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/articles/cell_level_covariates.html","id":"analysis","dir":"Articles","previous_headings":"","what":"Analysis","title":"Modeling continuous cell-level covariates","text":"Including variables regression formula uses summarized values corresponding cell type. happens behind scenes, user doesn’t need distinguish bewteen sample-level variables stored colData(pb) cell-level variables stored metadata(pb)$aggr_means. Variance partition hypothesis testing proceeds ususal:","code":"form = ~ StimStatus + value1 + value2  # Normalize and apply voom/voomWithDreamWeights res.proc = processAssays( pb, form, min.count=5)  # run variance partitioning analysis vp.lst = fitVarPart( res.proc, form)  # Summarize variance fractions genome-wide for each cell type plotVarPart(vp.lst, label.angle=60) # Differential expression analysis within each assay res.dl = dreamlet( res.proc, form)  # dreamlet results include coefficients for value1 and value2 res.dl ## class: dreamletResult  ## assays(8): B cells CD14+ Monocytes ... Megakaryocytes NK cells ## Genes: ##  min: 182  ##  max: 5262  ## details(4): assay n_retain formula formDropsTerms ## coefNames(4): (Intercept) StimStatusstim value1 value2"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/articles/cell_level_covariates.html","id":"session-info","dir":"Articles","previous_headings":"","what":"Session Info","title":"Modeling continuous cell-level covariates","text":"","code":"## R version 4.2.0 (2022-04-22) ## Platform: x86_64-apple-darwin19.6.0 (64-bit) ## Running under: macOS Catalina 10.15.7 ##  ## Matrix products: default ## BLAS:   /System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libBLAS.dylib ## LAPACK: /System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libLAPACK.dylib ##  ## locale: ## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8 ##  ## attached base packages: ## [1] splines   stats4    stats     graphics  grDevices utils     datasets  ## [8] methods   base      ##  ## other attached packages: ##  [1] lme4_1.1-31                 Matrix_1.5-3                ##  [3] muscData_1.10.0             scater_1.24.0               ##  [5] scuttle_1.6.3               SingleCellExperiment_1.18.1 ##  [7] SummarizedExperiment_1.26.1 Biobase_2.58.0              ##  [9] GenomicRanges_1.48.0        GenomeInfoDb_1.32.4         ## [11] IRanges_2.30.1              S4Vectors_0.34.0            ## [13] MatrixGenerics_1.8.1        matrixStats_0.63.0          ## [15] ExperimentHub_2.4.0         AnnotationHub_3.4.0         ## [17] BiocFileCache_2.4.0         dbplyr_2.2.1                ## [19] BiocGenerics_0.44.0         muscat_1.11.2               ## [21] dreamlet_0.0.62             variancePartition_1.28.5    ## [23] BiocParallel_1.32.0         limma_3.54.0                ## [25] ggplot2_3.4.1               ##  ## loaded via a namespace (and not attached): ##   [1] rappdirs_0.3.3                scattermore_0.8               ##   [3] mashr_0.2.57                  ragg_1.2.4                    ##   [5] tidyr_1.2.1                   clusterGeneration_1.3.7       ##   [7] bit64_4.0.5                   knitr_1.41                    ##   [9] irlba_2.3.5.1                 DelayedArray_0.22.0           ##  [11] data.table_1.14.6             KEGGREST_1.36.3               ##  [13] RCurl_1.98-1.9                doParallel_1.0.17             ##  [15] generics_0.1.3                ScaledMatrix_1.4.1            ##  [17] RhpcBLASctl_0.21-247.1        RSQLite_2.2.19                ##  [19] future_1.29.0                 bit_4.0.5                     ##  [21] httpuv_1.6.6                  assertthat_0.2.1              ##  [23] viridis_0.6.2                 xfun_0.35                     ##  [25] hms_1.1.2                     jquerylib_0.1.4               ##  [27] promises_1.2.0.1              babelgene_22.9                ##  [29] evaluate_0.18                 fansi_1.0.4                   ##  [31] progress_1.2.2                caTools_1.18.2                ##  [33] Rgraphviz_2.40.0              DBI_1.1.3                     ##  [35] geneplotter_1.74.0            purrr_0.3.5                   ##  [37] ellipsis_0.3.2                dplyr_1.0.10                  ##  [39] backports_1.4.1               annotate_1.74.0               ##  [41] aod_1.3.2                     sparseMatrixStats_1.8.0       ##  [43] vctrs_0.5.2                   abind_1.4-5                   ##  [45] cachem_1.0.6                  withr_2.5.0                   ##  [47] sctransform_0.3.5             prettyunits_1.1.1             ##  [49] softImpute_1.4-1              cluster_2.1.4                 ##  [51] crayon_1.5.2                  genefilter_1.78.0             ##  [53] labeling_0.4.2                edgeR_3.38.4                  ##  [55] pkgconfig_2.0.3               nlme_3.1-160                  ##  [57] vipor_0.4.5                   blme_1.0-5                    ##  [59] rlang_1.0.6                   globals_0.16.2                ##  [61] lifecycle_1.0.3               filelock_1.0.2                ##  [63] rsvd_1.0.5                    invgamma_1.1                  ##  [65] rprojroot_2.0.3               graph_1.74.0                  ##  [67] ashr_2.2-54                   Rhdf5lib_1.18.2               ##  [69] boot_1.3-28.1                 beeswarm_0.4.0                ##  [71] GlobalOptions_0.1.2           png_0.1-8                     ##  [73] viridisLite_0.4.1             rjson_0.2.21                  ##  [75] bitops_1.0-7                  KernSmooth_2.23-20            ##  [77] rhdf5filters_1.8.0            EnrichmentBrowser_2.26.0      ##  [79] Biostrings_2.64.1             blob_1.2.3                    ##  [81] DelayedMatrixStats_1.18.2     shape_1.4.6                   ##  [83] mixsqp_0.3-48                 stringr_1.5.0                 ##  [85] SQUAREM_2021.1                parallelly_1.32.1             ##  [87] remaCor_0.0.11                rmeta_3.0                     ##  [89] beachmat_2.12.0               scales_1.2.1                  ##  [91] memoise_2.0.1                 GSEABase_1.58.0               ##  [93] magrittr_2.0.3                plyr_1.8.8                    ##  [95] gplots_3.1.3                  zlibbioc_1.42.0               ##  [97] compiler_4.2.0                RColorBrewer_1.1-3            ##  [99] clue_0.3-63                   KEGGgraph_1.56.0              ## [101] DESeq2_1.36.0                 cli_3.6.0                     ## [103] XVector_0.36.0                lmerTest_3.1-3                ## [105] listenv_0.8.0                 TMB_1.9.1                     ## [107] MASS_7.3-58.1                 tidyselect_1.2.0              ## [109] stringi_1.7.8                 textshaping_0.3.6             ## [111] highr_0.9                     zenith_0.99.13                ## [113] yaml_2.3.6                    BiocSingular_1.12.0           ## [115] locfit_1.5-9.6                ggrepel_0.9.2                 ## [117] grid_4.2.0                    sass_0.4.4                    ## [119] tools_4.2.0                   future.apply_1.10.0           ## [121] parallel_4.2.0                circlize_0.4.15               ## [123] foreach_1.5.2                 gridExtra_2.3                 ## [125] farver_2.1.1                  RcppZiggurat_0.1.6            ## [127] digest_0.6.30                 BiocManager_1.30.19           ## [129] shiny_1.7.3                   Rcpp_1.0.9                    ## [131] broom_1.0.1                   later_1.3.0                   ## [133] BiocVersion_3.15.2            httr_1.4.4                    ## [135] AnnotationDbi_1.58.0          ComplexHeatmap_2.12.1         ## [137] Rdpack_2.4                    colorspace_2.1-0              ## [139] XML_3.99-0.13                 fs_1.5.2                      ## [141] truncnorm_1.0-8               pkgdown_2.0.6                 ## [143] systemfonts_1.0.4             xtable_1.8-4                  ## [145] jsonlite_1.8.4                nloptr_2.0.3                  ## [147] Rfast_2.0.6                   R6_2.5.1                      ## [149] RUnit_0.4.32                  mime_0.12                     ## [151] pillar_1.8.1                  htmltools_0.5.3               ## [153] glue_1.6.2                    fastmap_1.1.0                 ## [155] minqa_1.2.5                   BiocNeighbors_1.14.0          ## [157] interactiveDisplayBase_1.34.0 codetools_0.2-18              ## [159] mvtnorm_1.1-3                 utf8_1.2.3                    ## [161] lattice_0.20-45               bslib_0.4.1                   ## [163] tibble_3.1.8                  numDeriv_2016.8-1.1           ## [165] pbkrtest_0.5.1                curl_4.3.3                    ## [167] ggbeeswarm_0.6.0              gtools_3.9.4                  ## [169] survival_3.4-0                glmmTMB_1.1.5                 ## [171] rmarkdown_2.18                desc_1.4.2                    ## [173] munsell_0.5.0                 GetoptLong_1.0.5              ## [175] rhdf5_2.40.0                  GenomeInfoDbData_1.2.8        ## [177] iterators_1.0.14              HDF5Array_1.24.2              ## [179] reshape2_1.4.4                gtable_0.3.1                  ## [181] msigdbr_7.5.1                 rbibutils_2.2.10"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/articles/dreamlet.html","id":"process-single-cell-count-data","dir":"Articles","previous_headings":"","what":"Process single cell count data","title":"Dreamlet analysis of single cell RNA-seq","text":"perform analysis PBMCs 8 individuals stimulated interferon-β Kang, et al, 2018, Nature Biotech. small dataset repeated measures high dimensional batch effects, sophisticated features dreamlet strictly necessary. gives us opportunity walk standard dreamlet workflow.","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/articles/dreamlet.html","id":"preprocess-data","dir":"Articles","previous_headings":"Process single cell count data","what":"Preprocess data","title":"Dreamlet analysis of single cell RNA-seq","text":", single cell RNA-seq data downloaded ExperimentHub.","code":"library(dreamlet) library(muscat) library(ExperimentHub) library(zenith) library(scater)  # Download data, specifying EH2259 for the Kang, et al study eh <- ExperimentHub() sce <- eh[[\"EH2259\"]]  # only keep singlet cells with sufficient reads sce <- sce[rowSums(counts(sce) > 0) > 0, ] sce <- sce[,colData(sce)$multiplets == 'singlet']  # compute QC metrics qc <- perCellQCMetrics(sce)  # remove cells with few or many detected genes ol <- isOutlier(metric = qc$detected, nmads = 2, log = TRUE) sce <- sce[, !ol]  # set variable indicating stimulated (stim) or control (ctrl) sce$StimStatus = sce$stim"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/articles/dreamlet.html","id":"aggregate-to-pseudobulk","dir":"Articles","previous_headings":"Process single cell count data","what":"Aggregate to pseudobulk","title":"Dreamlet analysis of single cell RNA-seq","text":"Dreamlet, like muscat, performs analysis pseudobulk-level summing raw counts across cells given sample cell type. aggregateToPseudoBulk substantially faster large -disk datasets muscat::aggregateData.","code":"# Since 'ind' is the individual and 'StimStatus' is the stimulus status, # create unique identifier for each sample sce$id <- paste0(sce$StimStatus, sce$ind)  # Create pseudobulk data by specifying cluster_id and sample_id # Count data for each cell type is then stored in the `assay` field # assay: entry in assayNames(sce) storing raw counts # cluster_id: variable in colData(sce) indicating cell clusters # sample_id: variable in colData(sce) indicating sample id for aggregating cells pb <- aggregateToPseudoBulk(sce,     assay = \"counts\",          cluster_id = \"cell\",       sample_id = \"id\",     verbose = FALSE)  # one 'assay' per cell type assayNames(pb) ## [1] \"B cells\"           \"CD14+ Monocytes\"   \"CD4 T cells\"       ## [4] \"CD8 T cells\"       \"Dendritic cells\"   \"FCGR3A+ Monocytes\" ## [7] \"Megakaryocytes\"    \"NK cells\""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/articles/dreamlet.html","id":"voom-for-pseudobulk","dir":"Articles","previous_headings":"","what":"Voom for pseudobulk","title":"Dreamlet analysis of single cell RNA-seq","text":"Apply voom-style normalization pseudobulk counts within cell cluster using voomWithDreamWeights handle random effects (specified). processAssays() retains samples least min.cells given cell type. dropping samples usually problem, cases dropping sames can mean variable included regression formula longer variation. example, dropping stimulated samples analysis given cell type mean variable StimStatus variation perfectly colinear intercept term. colinearity issue detected internally variables problem dropped regression formula particular cell type. number samples retained resulting formula used cell type can accessed follows. analysis, samples dropped 3 cell types original formula remains valid case. mean-variance trend voom shown cell type. Cell types sufficient number cells reads show clear mean-variance trend. rare cell types like megakaryocytes, fewer genes sufficient reads trend less apparent.","code":"# Normalize and apply voom/voomWithDreamWeights res.proc = processAssays( pb, ~ StimStatus, min.count=5)  # the resulting object of class dreamletProcessedData stores  # normalized data and other information res.proc ## class: dreamletProcessedData  ## assays(8): B cells CD14+ Monocytes ... Megakaryocytes NK cells ## colData(4): ind stim multiplets StimStatus ## metadata(4): cell id ind cluster ## Samples: ##  min: 5  ##  max: 16 ## Genes: ##  min: 182  ##  max: 5262  ## details(3): assay n_retained formula # view details of dropping samples details(res.proc) ## DataFrame with 8 rows and 3 columns ##               assay n_retained     formula ##         <character>  <integer> <character> ## 1           B cells         16 ~StimStatus ## 2   CD14+ Monocytes         16 ~StimStatus ## 3       CD4 T cells         16 ~StimStatus ## 4       CD8 T cells         16 ~StimStatus ## 5   Dendritic cells          5 ~StimStatus ## 6 FCGR3A+ Monocytes         16 ~StimStatus ## 7    Megakaryocytes          9 ~StimStatus ## 8          NK cells         16 ~StimStatus # show voom plot for each cell clusters   plotVoom( res.proc) # Show plots for subset of cell clusters # plotVoom( res.proc[1:3] )  # Show plots for one cell cluster # plotVoom( res.proc[[\"B cells\"]])"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/articles/dreamlet.html","id":"variance-partitioning","dir":"Articles","previous_headings":"","what":"Variance partitioning","title":"Dreamlet analysis of single cell RNA-seq","text":"variancePartition package uses linear linear mixed models quanify contribution multiple sources expression variation gene-level. gene fits linear (mixed) model evalutes fraction expression variation explained variable. Variance fractions can visualized gene-level cell type using bar plot, genome-wide using violin plot.","code":"# run variance partitioning analysis vp.lst = fitVarPart( res.proc, ~ StimStatus) # Show variance fractions at the gene-level for each cell type genes = vp.lst$gene[2:4] plotPercentBars(vp.lst[vp.lst$gene %in% genes,]) # Summarize variance fractions genome-wide for each cell type plotVarPart(vp.lst, label.angle=60)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/articles/dreamlet.html","id":"differential-expression","dir":"Articles","previous_headings":"","what":"Differential expression","title":"Dreamlet analysis of single cell RNA-seq","text":"Since normalized expression data metadata stored within res.proc, regression formula remains specified. included stimulus status, analyses larger datasets can include covariates random effects. formula ~ StimStatus, intercept fit coefficient StimStatusstim log fold change simulated controls.","code":"# Differential expression analysis within each assay, # evaluated on the voom normalized data  res.dl = dreamlet( res.proc, ~ StimStatus)  # names of estimated coefficients coefNames(res.dl) ## [1] \"(Intercept)\"    \"StimStatusstim\" # the resulting object of class dreamletResult # stores results and other information res.dl ## class: dreamletResult  ## assays(8): B cells CD14+ Monocytes ... Megakaryocytes NK cells ## Genes: ##  min: 182  ##  max: 5262  ## details(4): assay n_retain formula formDropsTerms ## coefNames(2): (Intercept) StimStatusstim"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/articles/dreamlet.html","id":"volcano-plots","dir":"Articles","previous_headings":"Differential expression","what":"Volcano plots","title":"Dreamlet analysis of single cell RNA-seq","text":"volcano plot can indicate strength differential expression signal cell type. Red points indicate FDR < 0.05.","code":"plotVolcano( res.dl, coef = 'StimStatusstim' )"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/articles/dreamlet.html","id":"gene-level-heatmap","dir":"Articles","previous_headings":"Differential expression","what":"Gene-level heatmap","title":"Dreamlet analysis of single cell RNA-seq","text":"cell type specified gene, show z-statistic dreamlet analysis. Grey indicates insufficient reads observed include gene analysis.","code":"genes = c(\"ISG20\", \"ISG15\") plotGeneHeatmap( res.dl, coef=\"StimStatusstim\", genes=genes)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/articles/dreamlet.html","id":"extract-results","dir":"Articles","previous_headings":"Differential expression","what":"Extract results","title":"Dreamlet analysis of single cell RNA-seq","text":"entry res.dl stores model fit dream(), results can extracted using topTable() limma specifying coefficient interest. results shows gene name, log fold change, average expression, t-statistic, p-value, FDR (.e. adj.P.Val).","code":"# results from full analysis topTable(res.dl, coef = 'StimStatusstim' ) ## DataFrame with 10 rows and 9 columns ##              assay          ID     logFC   AveExpr         t     P.Value ##        <character> <character> <numeric> <numeric> <numeric>   <numeric> ## 1      CD4 T cells       ISG20   3.05572  10.40388   33.5203 7.41254e-22 ## 2      CD4 T cells        IFI6   5.66657   8.52892   33.4374 7.86231e-22 ## 3      CD4 T cells        MT2A   4.32225   7.80640   29.8773 1.13800e-20 ## 4      CD4 T cells       HERC5   4.23328   6.74189   29.5639 1.46058e-20 ## 5  CD14+ Monocytes       IL1RN   7.07056   7.79103   34.1843 2.29479e-20 ## 6          B cells       ISG15   5.54789  10.20272   26.6421 2.74841e-20 ## 7      CD4 T cells       ISG15   5.19158  10.06906   27.2208 1.02600e-19 ## 8      CD4 T cells     TNFSF10   4.39746   7.49081   26.4388 2.03723e-19 ## 9      CD4 T cells        GBP1   3.73059   7.16795   25.7287 3.86135e-19 ## 10         B cells       ISG20   3.35621  11.38360   23.8766 4.16884e-19 ##      adj.P.Val         B     z.std ##      <numeric> <numeric> <numeric> ## 1  5.76072e-18   40.0894   33.5203 ## 2  5.76072e-18   39.8546   33.4374 ## 3  5.35083e-17   37.3049   29.8773 ## 4  5.35083e-17   36.8698   29.5639 ## 5  6.71252e-17   35.8905   34.1843 ## 6  6.71252e-17   36.3706   26.6421 ## 7  2.14786e-16   35.2195   27.2208 ## 8  3.73169e-16   34.4771   26.4388 ## 9  5.57062e-16   33.8603   25.7287 ## 10 5.57062e-16   33.7695   23.8766 # only B cells topTable(res.dl[[\"B cells\"]], coef = 'StimStatusstim' ) ##           logFC   AveExpr        t      P.Value    adj.P.Val        B ## ISG15  5.547889 10.202722 26.64210 2.748406e-20 5.389625e-17 36.37060 ## ISG20  3.356214 11.383603 23.87659 4.168841e-19 4.087548e-16 33.76953 ## IRF7   3.727644  8.678591 19.37431 6.914653e-17 3.645751e-14 28.65759 ## LY6E   4.322173  8.706648 19.31609 7.436514e-17 3.645751e-14 28.57344 ## UBE2L6 2.739788  9.241028 18.82882 1.377804e-16 5.403746e-14 27.99829 ## EPSTI1 3.704608  8.107930 18.60426 1.839271e-16 6.011349e-14 27.65386 ## IFITM2 3.004151  8.731566 18.35019 2.559671e-16 7.170736e-14 27.37913 ## PLSCR1 4.094465  8.271191 18.22420 3.019961e-16 7.402680e-14 27.17151 ## SAT1   2.209092  9.657178 17.48641 8.115557e-16 1.768290e-13 26.21176 ## TRIM22 2.982051  7.201113 16.81383 2.062219e-15 4.044012e-13 25.24377"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/articles/dreamlet.html","id":"forest-plot","dir":"Articles","previous_headings":"Differential expression","what":"Forest plot","title":"Dreamlet analysis of single cell RNA-seq","text":"forest plot shows log fold change standard error given gene across cell types. color indicates FDR.","code":"plotForest( res.dl, coef = 'StimStatusstim', gene = 'ISG20')"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/articles/dreamlet.html","id":"advanced-used-of-contrasts","dir":"Articles","previous_headings":"Differential expression","what":"Advanced used of contrasts","title":"Dreamlet analysis of single cell RNA-seq","text":"hypothesis test difference two coefficients can performed using contrasts. contrast matrix evaluated cell type backend, contrast string must supplied dreamlet().  new Diff variable can used downstream analysis asking coefficient. note since intercept term model, meaning StimStatusstim changes . formula 0 + StimStatus StimStatusstim mean expression stimulated samples. information using contrasts see makeContrastsDream() vignette.","code":"# create a contrasts called 'Diff' that is the difference between expression # in the stimulated and controls. # More than one can be specified contrasts = c(Diff = 'StimStatusstim - StimStatusctrl')  # Evalaute the regression model without an intercept term. # Instead estimate the mean expression in stimulated, controls and then # set Diff to the difference between the two res.dl2 = dreamlet( res.proc, ~ 0 + StimStatus, contrasts=contrasts)  # see estimated coefficients coefNames(res.dl2) ## [1] \"Diff\"           \"StimStatusctrl\" \"StimStatusstim\" # Volcano plot of Diff plotVolcano( res.dl2[1:2], coef = 'Diff' )"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/articles/dreamlet.html","id":"gene-set-analysis","dir":"Articles","previous_headings":"","what":"Gene set analysis","title":"Dreamlet analysis of single cell RNA-seq","text":"standard enrichment methods like Fishers exact test, requires specifying FDR cutoff identify differentially expressed genes. However, dichotomizing differential expression results often simple ignores quantitative variation captured differential expression test statistics. use zenith, wrapper limma::camera, perform gene set analysis using full spectrum differential expression test statistics. zenith/camera competetive test compares mean test statistic genes given gene set, genes set accounting correlation genes. , zenith_gsa takes dreamletResult object, coefficient interest, gene sets GeneSetCollection object GSEABase.","code":"# Load Gene Ontology database  # use gene 'SYMBOL', or 'ENSEMBL' id # use get_MSigDB() to load MSigDB go.gs = get_GeneOntology(to=\"SYMBOL\")     # Run zenith gene set analysis on result of dreamlet res_zenith = zenith_gsa(res.dl, coef = 'StimStatusstim', go.gs)  # examine results for each ell type and gene set head(res_zenith) ##     assay           coef ## 1 B cells StimStatusstim ## 2 B cells StimStatusstim ## 3 B cells StimStatusstim ## 4 B cells StimStatusstim ## 5 B cells StimStatusstim ## 6 B cells StimStatusstim ##                                                      Geneset NGenes Correlation ## 1                       GO0051607: defense response to virus     40        0.01 ## 2                     GO0035456: response to interferon-beta     11        0.01 ## 3            GO0048525: negative regulation of viral process     19        0.01 ## 4 GO0045071: negative regulation of viral genome replication     13        0.01 ## 5             GO0060337: type I interferon signaling pathway     16        0.01 ## 6          GO0071357: cellular response to type I interferon     16        0.01 ##      delta        se    p.less    p.greater       PValue Direction         FDR ## 1 3.364151 0.4180884 0.9999994 6.400076e-07 1.280015e-06        Up 0.001335604 ## 2 5.662056 0.7091503 0.9999993 7.005803e-07 1.401161e-06        Up 0.001364544 ## 3 4.287736 0.5598734 0.9999989 1.133704e-06 2.267409e-06        Up 0.001840128 ## 4 4.985635 0.6594948 0.9999987 1.314913e-06 2.629827e-06        Up 0.001920825 ## 5 3.847592 0.6053595 0.9999911 8.903718e-06 1.780744e-05        Up 0.005254943 ## 6 3.847592 0.6053595 0.9999911 8.903718e-06 1.780744e-05        Up 0.005254943"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/articles/dreamlet.html","id":"heatmap-of-top-genesets","dir":"Articles","previous_headings":"Gene set analysis","what":"Heatmap of top genesets","title":"Dreamlet analysis of single cell RNA-seq","text":"","code":"# for each cell type select 5 genesets with largest t-statistic # and 1 geneset with the lowest # Grey boxes indicate the gene set could not be evaluted because #    to few genes were represented plotZenithResults(res_zenith, 5, 1)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/articles/dreamlet.html","id":"all-gene-sets-with-fdr-5","dir":"Articles","previous_headings":"Gene set analysis > Heatmap of top genesets","what":"All gene sets with FDR < 5%","title":"Dreamlet analysis of single cell RNA-seq","text":", show genes FDR < 5% cell type","code":"# get genesets with FDR < 5% gs = unique(res_zenith$Geneset[res_zenith$FDR < 0.05])  # keep only results of these genesets df = res_zenith[res_zenith$Geneset %in% gs,]  # plot results, but with no limit based on the highest/lowest t-statistic plotZenithResults(df, Inf, Inf)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/articles/dreamlet.html","id":"comparing-expression-in-clusters","dir":"Articles","previous_headings":"","what":"Comparing expression in clusters","title":"Dreamlet analysis of single cell RNA-seq","text":"Identifying genes differentially expressed cell clusters incorporates paired analysis design, since individual observed cell cluster.","code":"# test differential expression between B cells and the rest of the cell clusters ct.pairs = c(\"CD4 T cells\", \"rest\")   fit = dreamletCompareClusters( pb, ct.pairs, method=\"fixed\")  # The coefficient 'compare' is the value logFC between test and baseline: # compare = cellClustertest - cellClusterbaseline  df_Bcell = topTable(fit, coef=\"compare\")  head(df_Bcell) ##                             logFC   AveExpr         t      P.Value    adj.P.Val ## TYROBP                  -7.419602  7.917618 -85.70559 2.370028e-31 1.113913e-27 ## FTL                     -4.942146 13.169468 -62.42875 4.587228e-28 1.077999e-24 ## CD63                    -5.081503  8.760309 -56.16528 5.698308e-27 8.927349e-24 ## C15orf48                -7.290465  8.398874 -51.69563 4.100176e-26 4.817706e-23 ## HLA-DRA_ENSG00000204287 -6.424497  8.865795 -49.62863 1.081688e-25 1.016787e-22 ## CCL2                    -7.299489  8.725990 -47.80615 2.630893e-25 2.060866e-22 ##                                B ## TYROBP                  60.35900 ## FTL                     54.38099 ## CD63                    51.74976 ## C15orf48                49.73396 ## HLA-DRA_ENSG00000204287 48.87492 ## CCL2                    47.96901"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/articles/dreamlet.html","id":"gene-cluster-specificity","dir":"Articles","previous_headings":"","what":"Gene-cluster specificity","title":"Dreamlet analysis of single cell RNA-seq","text":"Evaluate specificity gene cluster, retaining highly expressed genes:  Highlight expression fraction specific gene cell type:","code":"df_cts = cellTypeSpecificity( pb )   # retain only genes with total CPM summed across cell type > 100 df_cts = df_cts[df_cts$totalCPM > 100,]  # Violin plot of specificity score for each cell type plotViolin(df_cts) genes = rownames(df_cts)[apply(df_cts, 2, which.max)] plotPercentBars( df_cts, genes = genes ) dreamlet::plotHeatmap( df_cts, genes = genes)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/articles/dreamlet.html","id":"session-info","dir":"Articles","previous_headings":"","what":"Session Info","title":"Dreamlet analysis of single cell RNA-seq","text":"","code":"## R version 4.2.0 (2022-04-22) ## Platform: x86_64-apple-darwin19.6.0 (64-bit) ## Running under: macOS Catalina 10.15.7 ##  ## Matrix products: default ## BLAS:   /System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libBLAS.dylib ## LAPACK: /System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libLAPACK.dylib ##  ## locale: ## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8 ##  ## attached base packages: ## [1] splines   stats4    stats     graphics  grDevices utils     datasets  ## [8] methods   base      ##  ## other attached packages: ##  [1] crumblr_0.99.6              GO.db_3.15.0                ##  [3] org.Hs.eg.db_3.15.0         AnnotationDbi_1.58.0        ##  [5] lme4_1.1-31                 Matrix_1.5-3                ##  [7] muscData_1.10.0             scater_1.24.0               ##  [9] scuttle_1.6.3               SingleCellExperiment_1.18.1 ## [11] SummarizedExperiment_1.26.1 Biobase_2.58.0              ## [13] GenomicRanges_1.48.0        GenomeInfoDb_1.32.4         ## [15] IRanges_2.30.1              S4Vectors_0.34.0            ## [17] MatrixGenerics_1.8.1        matrixStats_0.63.0          ## [19] zenith_0.99.13              ExperimentHub_2.4.0         ## [21] AnnotationHub_3.4.0         BiocFileCache_2.4.0         ## [23] dbplyr_2.2.1                BiocGenerics_0.44.0         ## [25] muscat_1.11.2               dreamlet_0.0.62             ## [27] variancePartition_1.28.5    BiocParallel_1.32.0         ## [29] limma_3.54.0                ggplot2_3.4.1               ##  ## loaded via a namespace (and not attached): ##   [1] rappdirs_0.3.3                scattermore_0.8               ##   [3] mashr_0.2.57                  ragg_1.2.4                    ##   [5] tidyr_1.2.1                   clusterGeneration_1.3.7       ##   [7] bit64_4.0.5                   knitr_1.41                    ##   [9] irlba_2.3.5.1                 DelayedArray_0.22.0           ##  [11] data.table_1.14.6             KEGGREST_1.36.3               ##  [13] RCurl_1.98-1.9                doParallel_1.0.17             ##  [15] generics_0.1.3                ScaledMatrix_1.4.1            ##  [17] RhpcBLASctl_0.21-247.1        RSQLite_2.2.19                ##  [19] stylo_0.7.4                   proxy_0.4-27                  ##  [21] future_1.29.0                 bit_4.0.5                     ##  [23] httpuv_1.6.6                  assertthat_0.2.1              ##  [25] viridis_0.6.2                 xfun_0.35                     ##  [27] hms_1.1.2                     jquerylib_0.1.4               ##  [29] promises_1.2.0.1              babelgene_22.9                ##  [31] evaluate_0.18                 fansi_1.0.4                   ##  [33] progress_1.2.2                caTools_1.18.2                ##  [35] Rgraphviz_2.40.0              DBI_1.1.3                     ##  [37] geneplotter_1.74.0            purrr_0.3.5                   ##  [39] ellipsis_0.3.2                dplyr_1.0.10                  ##  [41] backports_1.4.1               annotate_1.74.0               ##  [43] aod_1.3.2                     sparseMatrixStats_1.8.0       ##  [45] vctrs_0.5.2                   abind_1.4-5                   ##  [47] cachem_1.0.6                  withr_2.5.0                   ##  [49] sctransform_0.3.5             treeio_1.20.2                 ##  [51] prettyunits_1.1.1             softImpute_1.4-1              ##  [53] cluster_2.1.4                 lazyeval_0.2.2                ##  [55] ape_5.6-2                     crayon_1.5.2                  ##  [57] genefilter_1.78.0             labeling_0.4.2                ##  [59] edgeR_3.38.4                  pkgconfig_2.0.3               ##  [61] nlme_3.1-160                  vipor_0.4.5                   ##  [63] blme_1.0-5                    rlang_1.0.6                   ##  [65] globals_0.16.2                lifecycle_1.0.3               ##  [67] filelock_1.0.2                rsvd_1.0.5                    ##  [69] invgamma_1.1                  tcltk_4.2.0                   ##  [71] rprojroot_2.0.3               pamr_1.56.1                   ##  [73] graph_1.74.0                  aplot_0.1.9                   ##  [75] ashr_2.2-54                   Rhdf5lib_1.18.2               ##  [77] boot_1.3-28.1                 beeswarm_0.4.0                ##  [79] GlobalOptions_0.1.2           png_0.1-8                     ##  [81] viridisLite_0.4.1             rjson_0.2.21                  ##  [83] bitops_1.0-7                  KernSmooth_2.23-20            ##  [85] rhdf5filters_1.8.0            EnrichmentBrowser_2.26.0      ##  [87] Biostrings_2.64.1             blob_1.2.3                    ##  [89] DelayedMatrixStats_1.18.2     shape_1.4.6                   ##  [91] mixsqp_0.3-48                 stringr_1.5.0                 ##  [93] SQUAREM_2021.1                parallelly_1.32.1             ##  [95] gridGraphics_0.5-1            remaCor_0.0.11                ##  [97] rmeta_3.0                     beachmat_2.12.0               ##  [99] scales_1.2.1                  memoise_2.0.1                 ## [101] GSEABase_1.58.0               magrittr_2.0.3                ## [103] plyr_1.8.8                    gplots_3.1.3                  ## [105] zlibbioc_1.42.0               compiler_4.2.0                ## [107] RColorBrewer_1.1-3            clue_0.3-63                   ## [109] KEGGgraph_1.56.0              DESeq2_1.36.0                 ## [111] cli_3.6.0                     XVector_0.36.0                ## [113] lmerTest_3.1-3                listenv_0.8.0                 ## [115] patchwork_1.1.2               TMB_1.9.1                     ## [117] MASS_7.3-58.1                 tidyselect_1.2.0              ## [119] tcltk2_1.2-11                 stringi_1.7.8                 ## [121] textshaping_0.3.6             highr_0.9                     ## [123] yaml_2.3.6                    BiocSingular_1.12.0           ## [125] locfit_1.5-9.6                ggrepel_0.9.2                 ## [127] grid_4.2.0                    sass_0.4.4                    ## [129] tools_4.2.0                   future.apply_1.10.0           ## [131] parallel_4.2.0                circlize_0.4.15               ## [133] foreach_1.5.2                 gridExtra_2.3                 ## [135] farver_2.1.1                  RcppZiggurat_0.1.6            ## [137] digest_0.6.30                 BiocManager_1.30.19           ## [139] shiny_1.7.3                   Rcpp_1.0.9                    ## [141] broom_1.0.1                   later_1.3.0                   ## [143] BiocVersion_3.15.2            httr_1.4.4                    ## [145] ComplexHeatmap_2.12.1         Rdpack_2.4                    ## [147] colorspace_2.1-0              XML_3.99-0.13                 ## [149] fs_1.5.2                      truncnorm_1.0-8               ## [151] yulab.utils_0.0.5             tidytree_0.4.1                ## [153] pkgdown_2.0.6                 ggplotify_0.1.0               ## [155] systemfonts_1.0.4             xtable_1.8-4                  ## [157] ggtree_3.4.4                  jsonlite_1.8.4                ## [159] nloptr_2.0.3                  Rfast_2.0.6                   ## [161] ggfun_0.0.9                   R6_2.5.1                      ## [163] RUnit_0.4.32                  mime_0.12                     ## [165] pillar_1.8.1                  htmltools_0.5.3               ## [167] glue_1.6.2                    fastmap_1.1.0                 ## [169] minqa_1.2.5                   BiocNeighbors_1.14.0          ## [171] class_7.3-20                  interactiveDisplayBase_1.34.0 ## [173] codetools_0.2-18              tsne_0.1-3.1                  ## [175] mvtnorm_1.1-3                 utf8_1.2.3                    ## [177] lattice_0.20-45               bslib_0.4.1                   ## [179] tibble_3.1.8                  numDeriv_2016.8-1.1           ## [181] pbkrtest_0.5.1                curl_4.3.3                    ## [183] ggbeeswarm_0.6.0              gtools_3.9.4                  ## [185] survival_3.4-0                glmmTMB_1.1.5                 ## [187] rmarkdown_2.18                desc_1.4.2                    ## [189] munsell_0.5.0                 e1071_1.7-12                  ## [191] GetoptLong_1.0.5              rhdf5_2.40.0                  ## [193] GenomeInfoDbData_1.2.8        iterators_1.0.14              ## [195] HDF5Array_1.24.2              reshape2_1.4.4                ## [197] gtable_0.3.1                  msigdbr_7.5.1                 ## [199] rbibutils_2.2.10"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/articles/h5ad_on_disk.html","id":"on-disk-storage-zellkonverter","dir":"Articles","previous_headings":"","what":"On-disk storage: zellkonverter","title":"Handling large H5AD datasets","text":"zellkonverter takes advantage H5AD file format built HDF5 format order dramatically reduce memory usage still retaining performance. zellkonverter package uses DelayedArray backend provide seamless interface -disk H5AD dataset interface SingleCellExperiment class. zellkonverter interface python code. Note python dependencies installed first time readH5AD() run, rather package installed. first run readH5AD() can take minutes, subsequent runs fast.","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/articles/h5ad_on_disk.html","id":"standard-usage","dir":"Articles","previous_headings":"On-disk storage: zellkonverter","what":"Standard usage","title":"Handling large H5AD datasets","text":"","code":"library(zellkonverter) library(SingleCellExperiment)  # Create SingleCellExperiment object that points to on-disk H5AD file sce = readH5AD(h5ad_file, use_hdf5=TRUE)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/articles/h5ad_on_disk.html","id":"merge-multiple-datasets","dir":"Articles","previous_headings":"On-disk storage: zellkonverter","what":"Merge multiple datasets","title":"Handling large H5AD datasets","text":"","code":"# Read a series of H5AD files into a list # then combine them into a single merged SingleCellExperiment sce.lst = lapply( h5ad_files, function(file){   readH5AD(file, use_hdf5=TRUE)   }) sce = do.call(cbind, sce.list)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/articles/h5ad_on_disk.html","id":"access-alternative-data","dir":"Articles","previous_headings":"On-disk storage: zellkonverter","what":"Access alternative data","title":"Handling large H5AD datasets","text":"software, including pegasus, store normalized data default portion file save raw counts raw/ field. , load H5AD file generated pegasus.","code":"# read raw/ from H5AD file # raw = TRUE tells readH5AD() to read alternative data # Must use zellkonverter >=1.3.3 sce_in = readH5AD(h5ad_file, use_hdf5=TRUE, raw=TRUE)  # use `raw` as counts sce = swapAltExp(sce_in, \"raw\") # use raw as main counts(sce) = assay(sce, 'X')   # set counts assay to data in X assay(sce, 'X') = NULL          # free X"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/articles/h5ad_on_disk.html","id":"in-memory-storage-seurat","dir":"Articles","previous_headings":"","what":"In-memory storage: Seurat","title":"Handling large H5AD datasets","text":"Seurat can also convert import H5AD files, convert SingleCellExperiment. resulting SingleCellExperiment object stores data sparseMatrix.","code":"library(SingleCellExperiment) library(SeuratDisk)  # Convert h5ad file to h5seurat format Convert(h5ad_file, dest = \"h5seurat\")  # load Seurat file obj = LoadH5Seurat(h5seurat_file)  # Convert Seurat object to SingleCellExperiment sce <- as.SingleCellExperiment(obj)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/articles/h5ad_on_disk.html","id":"comparing-interfaces","dir":"Articles","previous_headings":"","what":"Comparing interfaces","title":"Handling large H5AD datasets","text":"SingleCellExperiment interface zellkonverter Seurat hides backend differences typical R user. usage dreamlet cases. small medium datasets, performance differences minimal. However, large datasets can substantial difference performance. Use zellkonverter DelayedMatrix minimize memory usage cost computationl performance. Use Seurat sparseMatrix can faster sufficent memory. aggregateToPseudoBulk() computing pseudobulk data uses different backend implements -disk DelayedMatrix -memory sparseMatrix. versions highly optimized compared naive implementation.","code":""},{"path":[]},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/articles/mashr.html","id":"preprocess-data","dir":"Articles","previous_headings":"Standard dreamlet analysis","what":"Preprocess data","title":"mashr analysis after dreamlet","text":"single cell RNA-seq data downloaded ExperimentHub","code":"library(dreamlet) library(muscat) library(ExperimentHub) library(zenith) library(scater)  # Download data, specifying EH2259 for the Kang, et al study eh <- ExperimentHub() sce <- eh[[\"EH2259\"]]  # only keep singlet cells with sufficient reads sce <- sce[rowSums(counts(sce) > 0) > 0, ] sce <- sce[,colData(sce)$multiplets == 'singlet']  # compute QC metrics qc <- perCellQCMetrics(sce)  # remove cells with few or many detected genes ol <- isOutlier(metric = qc$detected, nmads = 2, log = TRUE) sce <- sce[, !ol]  # compute normalized data sce <- sce[rowSums(counts(sce) > 1) >= 10, ] sce <- computeLibraryFactors(sce) sce <- logNormCounts(sce)  # set variable indicating stimulated (stim) or control (ctrl) sce$StimStatus = sce$stim"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/articles/mashr.html","id":"aggregate-to-pseudobulk","dir":"Articles","previous_headings":"Standard dreamlet analysis","what":"Aggregate to pseudobulk","title":"mashr analysis after dreamlet","text":"","code":"# Since 'ind' is the individual and 'StimStatus' is the stimulus status, # create unique identifier for each sample sce$id <- paste0(sce$StimStatus, sce$ind)  # Create pseudobulk data by specifying cluster_id and sample_id # Count data for each cell type is then stored in the `assay` field # assay: entry in assayNames(sce) storing raw counts # cluster_id: variable in colData(sce) indicating cell clusters # sample_id: variable in colData(sce) indicating sample id for aggregating cells pb <- aggregateToPseudoBulk(sce,     assay = \"counts\",          cluster_id = \"cell\",       sample_id = \"id\",     verbose = FALSE)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/articles/mashr.html","id":"dreamlet-for-pseudobulk","dir":"Articles","previous_headings":"Standard dreamlet analysis","what":"dreamlet for pseudobulk","title":"mashr analysis after dreamlet","text":"","code":"# Normalize and apply voom/voomWithDreamWeights res.proc = processAssays( pb, ~ StimStatus, min.count=5)  # Differential expression analysis within each assay, # evaluated on the voom normalized data  res.dl = dreamlet( res.proc, ~ StimStatus)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/articles/mashr.html","id":"run-mashr-analysis","dir":"Articles","previous_headings":"","what":"Run mashr analysis","title":"mashr analysis after dreamlet","text":"","code":"# run mashr model to borrow information across genes and # cell types in estimating coefficients' posterior distribution res_mash = run_mash(res.dl, coef='StimStatusstim')"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/articles/mashr.html","id":"summarize-mashr-results","dir":"Articles","previous_headings":"Run mashr analysis","what":"Summarize mashr results","title":"mashr analysis after dreamlet","text":"Compute summary mashr posterior distributions","code":"library(mashr)  # extract statistics from mashr model # NA values indicate genes not sufficiently expressed # in a given cell type  # original logFC head(res_mash$logFC.original)[1:4, 1:4] ##       B cells CD14+ Monocytes CD4 T cells CD8 T cells ## A1BG       NA              NA  -0.5198987          NA ## AAAS       NA              NA  -0.5396948          NA ## AAED1      NA        1.505068   0.1167030          NA ## AAK1       NA              NA  -0.9574641          NA # posterior mean for logFC head(get_pm(res_mash$model))[1:4, 1:4] ##       B cells CD14+ Monocytes CD4 T cells CD8 T cells ## A1BG       NA              NA -0.35942648          NA ## AAAS       NA              NA -0.33700049          NA ## AAED1      NA        1.435837  0.02311512          NA ## AAK1       NA              NA -0.88586852          NA # how many gene-by-celltype tests are significant # i.e.  if a gene is significant in 2 celltypes, it is counted twice table(get_lfsr(res_mash$model) < 0.05, useNA=\"ifany\") ##  ## FALSE  TRUE  <NA>  ##  9484  4857 29971 # how many genes are significant in at least one cell type table( apply(get_lfsr(res_mash$model), 1, min, na.rm=TRUE) < 0.05) ##  ## FALSE  TRUE  ##  3051  2488 # how many genes are significant in each cell type apply(get_lfsr(res_mash$model), 2, function(x) sum(x < 0.05, na.rm=TRUE)) ##           B cells   CD14+ Monocytes       CD4 T cells       CD8 T cells  ##               548              1936              1057               266  ##   Dendritic cells FCGR3A+ Monocytes    Megakaryocytes          NK cells  ##                94               434                48               474 # examine top set of genes # which genes are significant in at least 1 cell type sort(names(get_significant_results(res_mash$model)))[1:10] ##  [1] \"ACTB\"                  \"ACTG1_ENSG00000184009\" \"ARPC1B\"                ##  [4] \"ARPC5\"                 \"ATP6V0E1\"              \"ATP6V1G1\"              ##  [7] \"B2M\"                   \"BTF3\"                  \"BTG1\"                  ## [10] \"CALM1\" # There is a lot of variation in the raw logFC res_mash$logFC.original[\"ISG20\",] ##           B cells   CD14+ Monocytes       CD4 T cells       CD8 T cells  ##          3.318743          5.892474          3.051876          3.454028  ##   Dendritic cells FCGR3A+ Monocytes    Megakaryocytes          NK cells  ##          2.339701          4.407411          3.008427          3.661383 # posterior mean after borrowing across cell type and genes get_pm(res_mash$model)[\"ISG20\",] ##           B cells   CD14+ Monocytes       CD4 T cells       CD8 T cells  ##          3.317906          5.833697          3.052511          3.444354  ##   Dendritic cells FCGR3A+ Monocytes    Megakaryocytes          NK cells  ##          2.552804          4.383058          3.071633          3.657611"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/articles/mashr.html","id":"gene-set-analysis","dir":"Articles","previous_headings":"Run mashr analysis","what":"Gene set analysis","title":"mashr analysis after dreamlet","text":"Perform gene set analysis zenith using posterior mean coefficient   Volcano plot based local False Sign Rate (lFSR) estimated posterior distribution coefficient.","code":"# gene set analysis using mashr results library(zenith)  # Load Gene Ontology database  # use gene 'SYMBOL', or 'ENSEMBL' id # use get_MSigDB() to load MSigDB  go.gs = get_GeneOntology(to=\"SYMBOL\")  # valid values for statistic:  # \"tstatistic\", \"abs(tstatistic)\", \"logFC\", \"abs(logFC)\" df_gs = zenith_gsa(res_mash, go.gs)  # Heatmap of results plotZenithResults(df_gs, 5, 1) # forest plot based on mashr results plotForest(res_mash, \"ISG20\") # volcano plot based on mashr results # yaxis uses local false sign rate (lfsr) plotVolcano(res_mash)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Gabriel Hoffman. Author, maintainer.","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Hoffman G (2023). dreamlet: Cohort-scale differential expression analysis single cell data using linear (mixed) models. R package version 0.0.62, https://DiseaseNeurogenomics.github.io/dreamlet.","code":"@Manual{,   title = {dreamlet: Cohort-scale differential expression analysis of single cell data using linear (mixed) models},   author = {Gabriel Hoffman},   year = {2023},   note = {R package version 0.0.62},   url = {https://DiseaseNeurogenomics.github.io/dreamlet}, }"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/index.html","id":"scalable-differential-expression-analysis-of-single-cell-transcriptomics-datasets-with-complex-study-designs","dir":"","previous_headings":"","what":"Scalable differential expression analysis of single cell transcriptomics datasets with complex study designs","title":"Cohort-scale differential expression analysis of single cell data using linear (mixed) models","text":"dreamlet package enables differential expression analysis multi-sample single cell datasets using linear (mixed) models precision weights. Major functionality dreamlet package using Bioconductor SingleCellExperiment interface: aggregateToPseudoBulk()       Fast evaluation pseudobulk raw estimated counts processAssays()                             Normalize aggregated counts, compute precision weights fitVarPart()                                     Variance partitioning analysis dreamlet()                                           Differential expression analysis across samples dreamletCompareClusters()  Differential expression analysis across cell clusters zenith_gsa()                                      Gene set analysis full spectrum test statistics","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/index.html","id":"motivation","dir":"","previous_headings":"","what":"Motivation","title":"Cohort-scale differential expression analysis of single cell data using linear (mixed) models","text":"Recent advances single cell/nucleus transcriptomic technology enabled collection population-level data sets study cell type specific gene expression differences associated disease state, stimulus, genetic regulation. scale data, complex study designs, low read count per cell mean characterizing cell type specific molecular mechanisms requires user-friendly, purpose-built analytical framework. developed dreamlet package applies pseudobulk approach fits regression model gene cell cluster test differential expression across individuals associated trait interest. Use precision-weighted linear mixed models enables accounting repeated measures study designs, high dimensional batch effects, varying sequencing depth observed cells per biosample.","code":""},{"path":[]},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/index.html","id":"technical-intro","dir":"","previous_headings":"","what":"Technical intro","title":"Cohort-scale differential expression analysis of single cell data using linear (mixed) models","text":"Dreamlet enables analysis massive-scale single cell/nucleus transcriptome datasets addressing CPU memory usage limitations. Dreamlet performs preprocessing statistical analysis parallel multicore machines, can distribute work across multiple nodes compute cluster. Dreamlet also uses H5AD format -disk data storage enable data processing smaller chunks dramatically reduce memory usage. dreamlet workflow easily integrates Bioconductor ecosystem, uses SingleCellExperiment class facilitate compatibility analyses. Beyond differential expression testing, dreamlet provides seamless integration downstream analysis including quantifying sources expression variation, gene set analysis using full spectrum gene-level t-statistics, testing differences cell type composition visualizing results. Dreamlet builds previous work variance partitioning differential expression using precision-weighted linear mixed models variancePartition package. dreamlet package designed easily adopted users variancePartition limma.","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/index.html","id":"install","dir":"","previous_headings":"","what":"Install","title":"Cohort-scale differential expression analysis of single cell data using linear (mixed) models","text":"dreamlet >= v0.0.58 compatible BioC v3.16 R v4.2. dreamlet also compatible BioC v3.14 R v4.1 installing dependencies:","code":"# 1) Make sure Bioconductor is installed # 2) Install dreamlet and dependencies: devtools::install_github(\"DiseaseNeurogenomics/dreamlet\")"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/index.html","id":"dependencies","dir":"","previous_headings":"Install","what":"Dependencies","title":"Cohort-scale differential expression analysis of single cell data using linear (mixed) models","text":"case aren’t installed automatically:","code":"devtools::install_github(\"DiseaseNeurogenomics/variancePartition\") devtools::install_github(\"DiseaseNeurogenomics/zenith\")"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/aggregateNonCountSignal.html","id":null,"dir":"Reference","previous_headings":"","what":"Aggregation of single-cell signals — aggregateNonCountSignal","title":"Aggregation of single-cell signals — aggregateNonCountSignal","text":"Aggregation single-cell pseudobulk data non-count data.","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/aggregateNonCountSignal.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Aggregation of single-cell signals — aggregateNonCountSignal","text":"","code":"aggregateNonCountSignal(   sce,   assay = NULL,   sample_id = NULL,   cluster_id = NULL,   min.cells = 10,   min.signal = 0.01,   min.samples = 4,   min.prop = 0.4,   verbose = TRUE,   BPPARAM = SerialParam(progressbar = verbose) )"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/aggregateNonCountSignal.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Aggregation of single-cell signals — aggregateNonCountSignal","text":"sce SingleCellExperiment. assay character string specifying assay slot use  input data. Defaults 1st available (assayNames(x)[1]). sample_id character string specifying variable use sample id cluster_id character string specifying variable use cluster id min.cells minimum number observed cells sample included analysis min.signal minimum signal value gene considered expressed sample.  Proper value cutoff depends type signal value min.samples minimum number samples passing cutoffs cell cluster retained min.prop minimum proportion retained samples non-zero counts gene verbose logical. information progress reported? BPPARAM BiocParallelParam object specifying aggregation parallelized.","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/aggregateNonCountSignal.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Aggregation of single-cell signals — aggregateNonCountSignal","text":"dreamletProcessedData object","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/aggregateNonCountSignal.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Aggregation of single-cell signals — aggregateNonCountSignal","text":"dreamlet workflow can also applied non-count data. case, signal averaged across cells given sample cell type. aggregateNonCountSignal() performs roles aggregateToPseudoBulk() followed processAssays() using non-count data. cell cluster, samples least min.cells retained. clusters least min.samples retained samples kept. Features retained least min.signal least min.prop fraction samples. precision measurement inverse sampling variance. precision weights computed 1/sem^2, sem = sd(signal) / sqrt(n), signal stores values averaged across cells, n number cells.","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/aggregateToPseudoBulk.html","id":null,"dir":"Reference","previous_headings":"","what":"Aggregation of single-cell to pseudobulk data — aggregateToPseudoBulk","title":"Aggregation of single-cell to pseudobulk data — aggregateToPseudoBulk","text":"Aggregation single-cell pseudobulk data.  Adapted muscat::aggregateData syntax results.  can much faster SingleCellExperiment backed H5AD files using -disk storage.","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/aggregateToPseudoBulk.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Aggregation of single-cell to pseudobulk data — aggregateToPseudoBulk","text":"","code":"aggregateToPseudoBulk(   x,   assay = NULL,   sample_id = NULL,   cluster_id = NULL,   fun = c(\"sum\", \"mean\", \"median\", \"prop.detected\", \"num.detected\", \"sem\", \"number\"),   scale = FALSE,   verbose = TRUE,   BPPARAM = SerialParam(progressbar = verbose),   checkValues = TRUE )"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/aggregateToPseudoBulk.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Aggregation of single-cell to pseudobulk data — aggregateToPseudoBulk","text":"x SingleCellExperiment. assay character string specifying assay slot use input data. Defaults 1st available (assayNames(x)[1]). sample_id character string specifying variable use sample id cluster_id character string specifying variable use cluster id fun character string. Specifies function use summary statistic. Passed summarizeAssayByGroup2. scale logical. pseudo-bulks scaled effective library size & multiplied 1M? verbose logical. information progress reported? BPPARAM BiocParallelParam object specifying aggregation parallelized. checkValues logical. check signal values positive integers?","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/aggregateToPseudoBulk.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Aggregation of single-cell to pseudobulk data — aggregateToPseudoBulk","text":"SingleCellExperiment. Aggregation parameters (assay, , fun, scaled) stored  metadata()$agg_pars, = c(cluster_id, sample_id).  number cells aggregated accessible int_colData()$n_cells.","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/aggregateToPseudoBulk.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Aggregation of single-cell to pseudobulk data — aggregateToPseudoBulk","text":"Adapted muscat::aggregateData simular syntax results.  much faster SingleCellExperiment backed H5AD files using DelayedMatrix summarizes counts using DelayedMatrixStats.  function also includes optmizations sparseMatrix used Seurat using sparseMatrixStats. Keeps variables colData() constant within sample_id.  example, sex constant cells sample_id, retained variable pseudobulk result.  number expressed genes varies across cells within sample_id, dropped.","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/aggregateToPseudoBulk.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Aggregation of single-cell to pseudobulk data — aggregateToPseudoBulk","text":"Crowell, HL, Soneson, C, Germain, P-L, Calini, D,  Collin, L, Raposo, C, Malhotra, D & Robinson, MD:  discovery population-specific state transitions  multi-sample multi-condition single-cell RNA sequencing data.  bioRxiv 713412 (2018).  doi: https://doi.org/10.1101/713412","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/aggregateToPseudoBulk.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Aggregation of single-cell to pseudobulk data — aggregateToPseudoBulk","text":"Gabriel Hoffman, Helena L Crowell & Mark D Robinson","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/aggregateToPseudoBulk.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Aggregation of single-cell to pseudobulk data — aggregateToPseudoBulk","text":"","code":"library(muscat) library(SingleCellExperiment)  data(example_sce)  # create pseudobulk for each sample and cell cluster pb <- aggregateToPseudoBulk(example_sce,     assay = \"counts\",        cluster_id = 'cluster_id',     sample_id = 'sample_id',    verbose=FALSE)  # pseudobulk data from each cell type # is stored as its own assay  pb #> class: SingleCellExperiment  #> dim: 1267 4  #> metadata(3): experiment_info agg_pars aggr_means #> assays(5): B cells CD14+ Monocytes CD4 T cells CD8 T cells FCGR3A+ #>   Monocytes #> rownames(1267): HES4 ISG15 ... CSTB PRMT2 #> rowData names(2): ENSEMBL SYMBOL #> colnames(4): ctrl101 ctrl107 stim101 stim107 #> colData names(1): group_id #> reducedDimNames(0): #> mainExpName: NULL #> altExpNames(0):  # aggregate by cluster only,  # collapsing all samples into the same pseudobulk pb2 <- aggregateToPseudoBulk(example_sce, cluster_id = \"cluster_id\", verbose=FALSE)  pb2   #> class: SingleCellExperiment  #> dim: 1267 5  #> metadata(3): experiment_info agg_pars aggr_means #> assays(1): '' #> rownames(1267): HES4 ISG15 ... CSTB PRMT2 #> rowData names(2): ENSEMBL SYMBOL #> colnames(5): B cells CD14+ Monocytes CD4 T cells CD8 T cells FCGR3A+ #>   Monocytes #> colData names(0): #> reducedDimNames(0): #> mainExpName: NULL #> altExpNames(0):"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/as.dreamletResult.html","id":null,"dir":"Reference","previous_headings":"","what":"Convert list of regression fits to dreamletResult — as.dreamletResult","title":"Convert list of regression fits to dreamletResult — as.dreamletResult","text":"Convert list regression fits dreamletResult downstream analysis","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/as.dreamletResult.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Convert list of regression fits to dreamletResult — as.dreamletResult","text":"","code":"as.dreamletResult(fitList, df_details = NULL)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/as.dreamletResult.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Convert list of regression fits to dreamletResult — as.dreamletResult","text":"fitList list regression fit dream() df_details data.frame storing assay details","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/as.dreamletResult.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Convert list of regression fits to dreamletResult — as.dreamletResult","text":"object class dreamletResult","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/as.dreamletResult.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Convert list of regression fits to dreamletResult — as.dreamletResult","text":"Useful combining multiple runs dreamletCompareClusters() single dreamletResult downstream analysis","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/as.dreamletResult.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Convert list of regression fits to dreamletResult — as.dreamletResult","text":"","code":"library(muscat) library(SingleCellExperiment)   data(example_sce)  # create pseudobulk for each sample and cell cluster pb <- aggregateToPseudoBulk(example_sce,    assay = \"counts\",       cluster_id = 'cluster_id',    sample_id = 'sample_id',  verbose=FALSE)  # first comparison ct.pairs =  c(\"B cells\", \"CD14+ Monocytes\") fit = dreamletCompareClusters( pb, ct.pairs, method=\"fixed\") #> Initial filtering... #> Filtering for paired samples...  # second comparison ct.pairs2 =  c(\"B cells\", \"CD8 T cells\") fit2 = dreamletCompareClusters( pb, ct.pairs2, method=\"fixed\") #> Initial filtering... #> Filtering for paired samples...  # Make a list storing each result with a meaningful name fitList = list()  id = paste0('[', ct.pairs[1], ']_vs_[', ct.pairs[2], ']') fitList[[id]] = fit  id = paste0('[', ct.pairs2[1], ']_vs_[', ct.pairs2[2], ']') fitList[[id]] = fit2  # create a dreamletResult form this list res.compare = as.dreamletResult( fitList )  library(zenith) go.gs = get_GeneOntology(\"CC\", to=\"SYMBOL\") #> Using cached version from 2023-02-27 20:22:49  # Run zenith on each result. # The coef 'compare' is used for each model res_zenith = zenith_gsa(res.compare, go.gs, coef = 'compare')"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/assay-methods.html","id":null,"dir":"Reference","previous_headings":"","what":"Get assay — assay,dreamletResult,ANY-method","title":"Get assay — assay,dreamletResult,ANY-method","text":"Get assay Get assay Get assays name","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/assay-methods.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get assay — assay,dreamletResult,ANY-method","text":"","code":"# S4 method for dreamletResult,ANY assay(x, i, withDimnames = TRUE, ...)  # S4 method for dreamletProcessedData,ANY assay(x, i, withDimnames = TRUE, ...)  # S4 method for vpDF,ANY assay(x, i, withDimnames = TRUE, ...)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/assay-methods.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get assay — assay,dreamletResult,ANY-method","text":"x vpDF object number indicating index, string indicating assay withDimnames used ... arguments","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/assay-methods.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get assay — assay,dreamletResult,ANY-method","text":"return ith assay","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/assayNames-methods.html","id":null,"dir":"Reference","previous_headings":"","what":"Get assayNames — assayNames,dreamletResult-method","title":"Get assayNames — assayNames,dreamletResult-method","text":"Get assayNames Get assayNames Get aassayNames","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/assayNames-methods.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get assayNames — assayNames,dreamletResult-method","text":"","code":"# S4 method for dreamletResult assayNames(x, ...)  # S4 method for dreamletProcessedData assayNames(x, ...)  # S4 method for vpDF assayNames(x, ...)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/assayNames-methods.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get assayNames — assayNames,dreamletResult-method","text":"x vpDF object ... additional arguments","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/assayNames-methods.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get assayNames — assayNames,dreamletResult-method","text":"array assay names","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/buildClusterTreeFromPB.html","id":null,"dir":"Reference","previous_headings":"","what":"Hierarchical clustering on cell types from pseudobulk — buildClusterTreeFromPB","title":"Hierarchical clustering on cell types from pseudobulk — buildClusterTreeFromPB","text":"Perform hierarchical clustering cell types pseudobulk aggregating read counts cell type.","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/buildClusterTreeFromPB.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Hierarchical clustering on cell types from pseudobulk — buildClusterTreeFromPB","text":"","code":"buildClusterTreeFromPB(   pb,   method = c(\"complete\", \"ward.D\", \"single\", \"average\", \"mcquitty\", \"median\", \"centroid\",     \"ward.D2\"),   dist.method = c(\"euclidean\", \"maximum\", \"manhattan\", \"canberra\", \"binary\", \"minkowski\") )"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/buildClusterTreeFromPB.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Hierarchical clustering on cell types from pseudobulk — buildClusterTreeFromPB","text":"pb SingleCellObject storing pseudobulk cell type assay() field method clustering method hclust() dist.method distance metric","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/buildClusterTreeFromPB.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Hierarchical clustering on cell types from pseudobulk — buildClusterTreeFromPB","text":"hierarchical clustering object class hclust","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/buildClusterTreeFromPB.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Hierarchical clustering on cell types from pseudobulk — buildClusterTreeFromPB","text":"","code":"library(muscat) library(SingleCellExperiment)  data(example_sce)  # create pseudobulk for each sample and cell cluster pb <- aggregateToPseudoBulk(example_sce,     assay = \"counts\",        cluster_id = 'cluster_id',     sample_id = 'sample_id',    verbose=FALSE)  # Hierarchical clustering of cell types hcl = buildClusterTreeFromPB(pb)  plot(hcl)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/cellCounts.html","id":null,"dir":"Reference","previous_headings":"","what":"Extract cell counts — cellCounts","title":"Extract cell counts — cellCounts","text":"Extract matrix cell counts SingleCellExperiment","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/cellCounts.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Extract cell counts — cellCounts","text":"","code":"cellCounts(x)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/cellCounts.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Extract cell counts — cellCounts","text":"x SingleCellExperiment","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/cellCounts.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Extract cell counts — cellCounts","text":"matrix cell counts samples rows cell types columns","code":""},{"path":[]},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/cellCounts.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Extract cell counts — cellCounts","text":"","code":"library(muscat) library(SingleCellExperiment)  data(example_sce)  # create pseudobulk for each sample and cell cluster pb <- aggregateToPseudoBulk(example_sce,     assay = \"counts\",        cluster_id = 'cluster_id',     sample_id = 'sample_id',    verbose=FALSE)  # get matrix of cell counts for each sample cellCounts(pb) #>         B cells CD14+ Monocytes CD4 T cells CD8 T cells FCGR3A+ Monocytes #> ctrl101     100             100         100          74                80 #> ctrl107      44             100         100          20                32 #> stim101     100             100         100         100               100 #> stim107      54             100         100          15                37"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/cellSpecificityValues-class.html","id":null,"dir":"Reference","previous_headings":"","what":"Class cellSpecificityValues — cellSpecificityValues-class","title":"Class cellSpecificityValues — cellSpecificityValues-class","text":"Class cellSpecificityValues cell type specificity values gene cell type","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/cellTypeSpecificity.html","id":null,"dir":"Reference","previous_headings":"","what":"Get cell type specificity of gene expression — cellTypeSpecificity","title":"Get cell type specificity of gene expression — cellTypeSpecificity","text":"gene, compute fraction overall expression attributable cell type","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/cellTypeSpecificity.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get cell type specificity of gene expression — cellTypeSpecificity","text":"","code":"cellTypeSpecificity(pb, ...)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/cellTypeSpecificity.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get cell type specificity of gene expression — cellTypeSpecificity","text":"pb SingleCellExperiment pseudobulk data easy assay cell type. ... arguments passed edgeR::calcNormFactors()","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/cellTypeSpecificity.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get cell type specificity of gene expression — cellTypeSpecificity","text":"matrix fraction expression attributable cell type gene.","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/cellTypeSpecificity.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Get cell type specificity of gene expression — cellTypeSpecificity","text":"Sum counts cell type, compute fraction counts-per-million attributable cell type gene","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/cellTypeSpecificity.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Get cell type specificity of gene expression — cellTypeSpecificity","text":"","code":"library(muscat) library(SingleCellExperiment)  data(example_sce)  # create pseudobulk for each sample and cell cluster pb <- aggregateToPseudoBulk(example_sce,    assay = \"counts\",       cluster_id = 'cluster_id',    sample_id = 'sample_id',   verbose=FALSE)  # Compute cell type specificity of each gene df = cellTypeSpecificity( pb)  # Violin plot of specificity scores for each cell type # Dashed line indicates genes that are equally expressed # across all cell types.  For K cell types, this is 1/K plotViolin(df)   # Compute the maximum specificity score for each gene scoreMax = apply(df, 1, max) head(scoreMax) #>       HES4      ISG15   AURKAIP1     MRPL20      SSU72       RER1  #>   585.0935 61555.5769  1012.0795   644.9976   835.4867  1049.8381   # For each cell type, get most specific gene genes = rownames(df)[apply(df, 2, which.max)]    # Barplot of 5 genes plotPercentBars( df, genes = genes)   # heatmap of 5 genes that are most cell type specific dreamlet::plotHeatmap( df, genes = genes)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/checkFormula.html","id":null,"dir":"Reference","previous_headings":"","what":"Check variables in a formula — checkFormula","title":"Check variables in a formula — checkFormula","text":"Check variables formula present data","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/checkFormula.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Check variables in a formula — checkFormula","text":"","code":"checkFormula(formula, data)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/checkFormula.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Check variables in a formula — checkFormula","text":"formula formula variables check data data.frame storing variables formula","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/checkFormula.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Check variables in a formula — checkFormula","text":"formula valid, return TRUE.  Else throw error","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/checkFormula.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Check variables in a formula — checkFormula","text":"","code":"# Valid formula dreamlet:::checkFormula( ~ speed, cars)  # Not valid formula # dreamlet:::checkFormula( ~ speed + a, cars)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/coefNames-methods.html","id":null,"dir":"Reference","previous_headings":"","what":"Get coefficient names — coefNames","title":"Get coefficient names — coefNames","text":"Get coefficient names","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/coefNames-methods.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get coefficient names — coefNames","text":"","code":"coefNames(obj)  # S4 method for dreamletResult coefNames(obj)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/coefNames-methods.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get coefficient names — coefNames","text":"obj dreamletResult object","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/coefNames-methods.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get coefficient names — coefNames","text":"array storing names coefficients","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/coefNames-methods.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Get coefficient names — coefNames","text":"","code":"library(muscat) library(SingleCellExperiment)  data(example_sce)  # create pseudobulk for each sample and cell cluster pb <- aggregateToPseudoBulk(example_sce,     assay = \"counts\",        cluster_id = 'cluster_id',     sample_id = 'sample_id',    verbose=FALSE)  # voom-style normalization res.proc = processAssays( pb, ~ group_id) #>   B cells... #> 0.079 secs #>   CD14+ Monocytes... #> 0.021 secs #>   CD4 T cells... #> 0.023 secs #>   CD8 T cells... #> 0.021 secs #>   FCGR3A+ Monocytes... #> 0.023 secs  # Differential expression analysis within each assay, # evaluated on the voom normalized data  res.dl = dreamlet( res.proc, ~ group_id) #>   B cells... #> 0.074 secs #>   CD14+ Monocytes... #> 0.089 secs #>   CD4 T cells... #> 0.071 secs #>   CD8 T cells... #> 0.045 secs #>   FCGR3A+ Monocytes... #> 0.096 secs #>   # show coefficients estimated for each cell type coefNames(res.dl) #> [1] \"(Intercept)\"  \"group_idstim\""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/colData-dreamletProcessedData-method.html","id":null,"dir":"Reference","previous_headings":"","what":"Extract colData from dreamletProcessedData — colData,dreamletProcessedData-method","title":"Extract colData from dreamletProcessedData — colData,dreamletProcessedData-method","text":"Extract colData dreamletProcessedData","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/colData-dreamletProcessedData-method.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Extract colData from dreamletProcessedData — colData,dreamletProcessedData-method","text":"","code":"# S4 method for dreamletProcessedData colData(x, ...)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/colData-dreamletProcessedData-method.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Extract colData from dreamletProcessedData — colData,dreamletProcessedData-method","text":"x dreamletProcessedData object ... arguments","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/colData-dreamletProcessedData-method.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Extract colData from dreamletProcessedData — colData,dreamletProcessedData-method","text":"object colData field","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/computeCellCounts.html","id":null,"dir":"Reference","previous_headings":"","what":"Get cell counts with metadata — computeCellCounts","title":"Get cell counts with metadata — computeCellCounts","text":"Get cell counts metadata sample","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/computeCellCounts.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get cell counts with metadata — computeCellCounts","text":"","code":"computeCellCounts(sce, annotation, sampleIDs)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/computeCellCounts.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get cell counts with metadata — computeCellCounts","text":"sce SingleCellExperiment annotation string indicating column colData(sce) storing cell type annotations sampleIDs string indicating column colData(sce) storing sample identifers","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/computeCellCounts.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get cell counts with metadata — computeCellCounts","text":"matrix storing cell counts","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/computeCellCounts.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Get cell counts with metadata — computeCellCounts","text":"","code":"library(muscat) library(SingleCellExperiment)  data(example_sce)  counts = computeCellCounts(example_sce, \"cluster_id\", \"sample_id\")  counts[1:4, 1:4] #>         B cells CD14+ Monocytes CD4 T cells CD8 T cells #> ctrl101     100             100         100          74 #> ctrl107      44             100         100          20 #> stim101     100             100         100         100 #> stim107      54             100         100          15"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/details-methods.html","id":null,"dir":"Reference","previous_headings":"","what":"Extract details from dreamletProcessedData — details","title":"Extract details from dreamletProcessedData — details","text":"Extract details dreamletProcessedData","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/details-methods.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Extract details from dreamletProcessedData — details","text":"","code":"details(object)  # S4 method for dreamletProcessedData details(object)  # S4 method for dreamletResult details(object)  # S4 method for vpDF details(object)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/details-methods.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Extract details from dreamletProcessedData — details","text":"object dreamletProcessedData object","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/details-methods.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Extract details from dreamletProcessedData — details","text":"Extract detailed information classes","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/details-methods.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Extract details from dreamletProcessedData — details","text":"","code":"library(muscat) library(SingleCellExperiment)  data(example_sce)  # create pseudobulk for each sample and cell cluster pb <- aggregateToPseudoBulk(example_sce,     assay = \"counts\",        cluster_id = 'cluster_id',     sample_id = 'sample_id',    verbose=FALSE)  # voom-style normalization res.proc = processAssays( pb, ~ group_id) #>   B cells... #> 0.022 secs #>   CD14+ Monocytes... #> 0.021 secs #>   CD4 T cells... #> 0.045 secs #>   CD8 T cells... #> 0.02 secs #>   FCGR3A+ Monocytes... #> 0.024 secs  # For each cell type, number of samples retained,  # and variables retained details(res.proc) #> DataFrame with 5 rows and 3 columns #>               assay n_retained     formula #>         <character>  <integer> <character> #> 1           B cells          4   ~group_id #> 2   CD14+ Monocytes          4   ~group_id #> 3       CD4 T cells          4   ~group_id #> 4       CD8 T cells          4   ~group_id #> 5 FCGR3A+ Monocytes          4   ~group_id"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/dreamlet.html","id":null,"dir":"Reference","previous_headings":"","what":"Differential expression for each assay — dreamlet","title":"Differential expression for each assay — dreamlet","text":"Perform differential expression assay using linear (mixed) models","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/dreamlet.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Differential expression for each assay — dreamlet","text":"","code":"dreamlet(   x,   formula,   data = colData(x),   assays = assayNames(x),   contrasts = NULL,   min.cells = 10,   robust = FALSE,   quiet = FALSE,   BPPARAM = SerialParam(),   use.eBayes = TRUE,   ... )  # S4 method for dreamletProcessedData dreamlet(   x,   formula,   data = colData(x),   assays = assayNames(x),   contrasts = NULL,   min.cells = 10,   robust = FALSE,   quiet = FALSE,   BPPARAM = SerialParam(),   use.eBayes = TRUE,   ... )"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/dreamlet.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Differential expression for each assay — dreamlet","text":"x SingleCellExperiment dreamletProcessedData object formula regression formula differential expression analysis data metadata used regression formula assays array assay names include analysis. Defaults assayNames(x) contrasts character vector specifying contrasts specifying linear combinations fixed effects test.  fed makeContrastsDream( formula, data, contrasts=contrasts) min.cells minimum number observed cells sample included analysis robust logical, use eBayes method robust outlier genes quiet show messages BPPARAM parameters parallel evaluation use.eBayes eBayes used result? (defualt: TRUE) ... arguments passed dream","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/dreamlet.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Differential expression for each assay — dreamlet","text":"Object class dreamletResult storing results cell type","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/dreamlet.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Differential expression for each assay — dreamlet","text":"Fit linear (mixed) model cell type separately.  advanced use contrasts see variancePartition::makeContrastsDream() vignette https://gabrielhoffman.github.io/variancePartition/articles/dream.html#advanced-hypothesis-testing-1.","code":""},{"path":[]},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/dreamlet.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Differential expression for each assay — dreamlet","text":"","code":"library(muscat) library(SingleCellExperiment)  data(example_sce)  # create pseudobulk for each sample and cell cluster pb <- aggregateToPseudoBulk(example_sce,     assay = \"counts\",        cluster_id = 'cluster_id',     sample_id = 'sample_id',    verbose=FALSE)  # voom-style normalization res.proc = processAssays( pb, ~ group_id) #>   B cells... #> 0.022 secs #>   CD14+ Monocytes... #> 0.021 secs #>   CD4 T cells... #> 0.023 secs #>   CD8 T cells... #> 0.021 secs #>   FCGR3A+ Monocytes... #> 0.024 secs  # Differential expression analysis within each assay, # evaluated on the voom normalized data  res.dl = dreamlet( res.proc, ~ group_id) #>   B cells... #> 0.062 secs #>   CD14+ Monocytes... #> 0.089 secs #>   CD4 T cells... #> 0.068 secs #>   CD8 T cells... #> 0.036 secs #>   FCGR3A+ Monocytes... #> 0.082 secs #>   # show coefficients estimated for each cell type coefNames(res.dl) #> [1] \"(Intercept)\"  \"group_idstim\"  # extract results using limma-style syntax # combines all cell types together # adj.P.Val gives study-wide FDR topTable(res.dl, coef=\"group_idstim\", number=3) #> DataFrame with 3 rows and 9 columns #>         assay          ID     logFC   AveExpr         t     P.Value   adj.P.Val #>   <character> <character> <numeric> <numeric> <numeric>   <numeric>   <numeric> #> 1 CD8 T cells       ISG20   3.72806   10.9147   16.8000 3.90507e-32 1.37029e-28 #> 2     B cells       ISG20   3.59771   11.5794   16.8407 5.01550e-20 8.79970e-17 #> 3 CD4 T cells       ISG15   5.50055   10.1672   21.9010 2.62269e-15 3.06767e-12 #>           B     z.std #>   <numeric> <numeric> #> 1   62.5196   16.8000 #> 2   35.4471   16.8407 #> 3   24.3335   21.9010"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/dreamletCompareClusters.html","id":null,"dir":"Reference","previous_headings":"","what":"Differential expression between pair of assays — dreamletCompareClusters","title":"Differential expression between pair of assays — dreamletCompareClusters","text":"Perform differential expression pair assays using linear (mixed) models","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/dreamletCompareClusters.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Differential expression between pair of assays — dreamletCompareClusters","text":"","code":"dreamletCompareClusters(   pb,   assays,   method = c(\"fixed\", \"random\", \"none\"),   formula = ~0,   collapse = TRUE,   min.cells = 10,   min.count = 10,   min.samples = 4,   isCounts = TRUE,   normalize.method = \"TMM\",   useCountsWeights = TRUE,   robust = FALSE,   quiet = FALSE,   contrasts = c(compare = paste(\"cellClustertest - cellClusterbaseline\")),   BPPARAM = SerialParam(),   errorsAsWarnings = FALSE,   ... )"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/dreamletCompareClusters.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Differential expression between pair of assays — dreamletCompareClusters","text":"pb pseudobulk data SingleCellExperiment object assays array two entries specifying assays (.e. cell clusters) compare, list two sets assays. method account repeated measures donors using \"random\" effect, \"fixed\" effect, \"none\" formula covariates include analysis. collapse TRUE (default), combine cell clusters within test set, separately baseline set. FALSE, estimate coefficient cell cluster identify differential expression using linear contrasts variancePartition::makeContrastsDream() min.cells minimum number observed cells sample included analysis min.count minimum number reads gene consider expressed sample.  Passed edgeR::filterByExpr min.samples minimum number samples passing cutoffs cell cluster retained isCounts logical, indicating data raw counts normalize.method normalization method used calcNormFactors useCountsWeights use cell count weights robust logical, use eBayes method robust outlier genes quiet show messages contrasts cell type encoded variable cellCluster levels test baseline. contrasts specifies contrasts passed variancePartition::makeContrastsDream().  Note, advanced users . BPPARAM parameters parallel evaluation errorsAsWarnings TRUE, convert error warning return NULL ... arguments passed dream","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/dreamletCompareClusters.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Differential expression between pair of assays — dreamletCompareClusters","text":"Object class dreamletResult storing results comparison","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/dreamletCompareClusters.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Differential expression between pair of assays — dreamletCompareClusters","text":"Analyze pseudobulk data identify differential gene expression two cell clusters sets clusters modeling cross-donor expression variation aspects study design. dreamletCompareClusters() useful finding genes differentially expressed betweeen cell clusters estimating fold change.  However, p-values number differentially expressed genes problematic two reasons, users must careful overinterpret : Cell clusters typically identified gene expression data used differential expression analysis clusters. data used discovery testing, means p-values differential expression analysis uniform null.  produce lot findings small p-values even absence true biological differences. dreamlet package designed large datasets many subjects.  sample sizes cohort studies order magnitude larger typical single cell studies.  means analyses huge power detect even subtle difference expression cell clusters.  cluster-specific marker genes often discovered handful samples, dreamlet package applicable 100s 1000s subjects. method indicates regression method used test differential expression sets cell clusters.  Since biosample usually represented sets cell clusters, method determines paired design modeled.   method = \"mixed\", sample modeled random effect: ~ (1|Sample) + .... method = \"fixed\", sample modeled fixed effect: ~ Sample + .... method = \"none\", pairing ignored. collapse=TRUE (default) combine cell clusters within test set, separately baseline set, estimate coefficient indicating differential expression sets given gene.  collapse=FALSE, estimate coefficient cell type identify differential expression using linear contrasts variancePartition::makeContrastsDream().","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/dreamletCompareClusters.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Differential expression between pair of assays — dreamletCompareClusters","text":"","code":"library(muscat) library(SingleCellExperiment)   data(example_sce)  # create pseudobulk for each sample and cell cluster pb <- aggregateToPseudoBulk(example_sce,    assay = \"counts\",       cluster_id = 'cluster_id',    sample_id = 'sample_id',   verbose=FALSE)  # Evaluate the specificity of each gene for each cluster df_cts = cellTypeSpecificity( pb )  # compare first two assays (i.e. cell types) ct.pairs =  c(\"B cells\", \"CD14+ Monocytes\")  # run comparison # use method = 'fixed' here since it is faster fit = dreamletCompareClusters( pb, ct.pairs, method=\"fixed\") #> Initial filtering... #> Filtering for paired samples...  # Extract top 10 differentially expressed genes # The coefficient 'compare' is the value logFC between test and baseline: # compare = cellClustertest - cellClusterbaseline  res = topTable(fit, coef='compare', number=10)  # genes with highest logFC are most highly expressed in  # B cells compared to CD14+ Monocytes head(res) #>             logFC   AveExpr         t      P.Value    adj.P.Val        B #> LGALS3  -4.816806  9.879829 -23.63531 6.877513e-11 2.734301e-08 15.43980 #> FTL     -4.564199 14.265849 -23.14857 8.639180e-11 2.734301e-08 15.38182 #> S100A10 -4.554573  9.950588 -20.89339 2.649274e-10 5.235895e-08 14.20355 #> S100A11 -4.691552 10.362616 -20.47182 3.308623e-10 5.235895e-08 14.00639 #> CD63    -3.888883 10.337664 -19.45422 5.762971e-10 7.295921e-08 13.49395 #> ANXA5   -3.673970 10.097965 -18.67233 8.996651e-10 9.491467e-08 13.05493  dreamlet::plotHeatmap( df_cts, genes = rownames(res)[1:5])   # compare B cells versus the rest of the cell types # 'rest' is a keyword indicating all other assays   fit = dreamletCompareClusters( pb, c(\"B cells\", 'rest'), method=\"fixed\") #> Initial filtering... #> Filtering for paired samples...  res = topTable(fit, coef='compare', number=10)  # genes with highest logFC are most highly expressed in  # B cells compared to all others head(res) #>             logFC   AveExpr         t      P.Value    adj.P.Val        B #> FTL     -3.611668 13.872811 -33.50421 9.981991e-16 8.873990e-13 26.46896 #> FTH1    -2.488733 15.497594 -26.99381 2.576095e-14 1.145074e-11 23.03711 #> ANXA1   -5.767273  8.777334 -26.00994 4.492584e-14 1.331302e-11 22.22040 #> S100A11 -4.235512 10.182616 -21.67526 6.800058e-13 1.511313e-10 19.91233 #> LGALS3  -3.908627  9.492690 -20.76951 1.279724e-12 2.275350e-10 19.24959 #> S100A10 -3.759699  9.613494 -19.60603 2.997582e-12 4.441418e-10 18.44009  # Get genes upregulated in B cells idx = with(res, which(logFC > 0))[1:5] dreamlet::plotHeatmap( df_cts, genes = rownames(res)[idx])   lst = list( test = c(\"CD14+ Monocytes\", \"FCGR3A+ Monocytes\"),      baseline= c(\"CD4 T cells\", \"CD8 T cells\"))  # compare 2 monocyte clusters to two T cell clusters fit = dreamletCompareClusters( pb, lst, method=\"fixed\") #> Initial filtering... #> Filtering for paired samples...  res = topTable(fit, coef='compare', number=10)  # genes with highest logFC are most highly expressed in  # monocytes compared to T cells head(res) #>                            logFC   AveExpr        t      P.Value    adj.P.Val #> FTL                     5.198559 13.603905 50.01440 1.092326e-12 9.470466e-10 #> TIMP1                   6.210031 11.076844 40.65163 7.542168e-12 3.269530e-09 #> HLA-DRA_ENSG00000204287 5.675747  9.655697 30.70867 1.023387e-10 2.957589e-08 #> S100A4                  4.514048  9.249845 26.98984 3.384453e-10 6.042015e-08 #> PSAP                    3.947873  9.342828 26.51227 3.992245e-10 6.042015e-08 #> SOD2                    5.688725  9.919582 26.37995 4.181325e-10 6.042015e-08 #>                                B #> FTL                     19.78358 #> TIMP1                   17.76489 #> HLA-DRA_ENSG00000204287 15.13660 #> S100A4                  14.12368 #> PSAP                    13.98677 #> SOD2                    13.92513  # Get genes upregulated in monocytes idx = with(res, which(logFC > 0))[1:5] dreamlet::plotHeatmap( df_cts, genes = rownames(res)[idx])"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/dreamletProcessedData-class.html","id":null,"dir":"Reference","previous_headings":"","what":"Class dreamletProcessedData — dreamletProcessedData-class","title":"Class dreamletProcessedData — dreamletProcessedData-class","text":"Class dreamletProcessedData","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/dreamletResult-class.html","id":null,"dir":"Reference","previous_headings":"","what":"Class dreamletResult — dreamletResult-class","title":"Class dreamletResult — dreamletResult-class","text":"Class dreamletResult stores results produced dreamlet() give standard interface downstream analysis","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/dreamlet_mash_result-class.html","id":null,"dir":"Reference","previous_headings":"","what":"Class dreamlet_mash_result — dreamlet_mash_result-class","title":"Class dreamlet_mash_result — dreamlet_mash_result-class","text":"Class dreamlet_mash_result","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/dropRedundantTerms.html","id":null,"dir":"Reference","previous_headings":"","what":"Drop redundant terms from the model — dropRedundantTerms","title":"Drop redundant terms from the model — dropRedundantTerms","text":"Detect co-linear fixed effects drop last one","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/dropRedundantTerms.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Drop redundant terms from the model — dropRedundantTerms","text":"","code":"dropRedundantTerms(formula, data, tol = 0.001)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/dropRedundantTerms.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Drop redundant terms from the model — dropRedundantTerms","text":"formula original formula data data.frame tol tolerance test difference correlation 1 -1","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/dropRedundantTerms.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Drop redundant terms from the model — dropRedundantTerms","text":"formula, possibly terms omitted.","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/dropRedundantTerms.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Drop redundant terms from the model — dropRedundantTerms","text":"","code":"# Valid formula dropRedundantTerms(~ group + extra, sleep) #> ~group + extra #> <environment: 0x7fd342523370>"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/equalFormulas.html","id":null,"dir":"Reference","previous_headings":"","what":"Check if two formulas are equal — equalFormulas","title":"Check if two formulas are equal — equalFormulas","text":"Check two formulas equal evaluating formulas extracting terms","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/equalFormulas.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Check if two formulas are equal — equalFormulas","text":"","code":"equalFormulas(formula1, formula2)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/equalFormulas.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Check if two formulas are equal — equalFormulas","text":"formula1 first formula formula2 second formula","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/equalFormulas.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Check if two formulas are equal — equalFormulas","text":"boolean value indciating formulas equivalent","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/equalFormulas.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Check if two formulas are equal — equalFormulas","text":"","code":"# These formulas are equivalent formula1 = ~ Size + 1 formula2 = ~ 1 + Size   dreamlet:::equalFormulas( formula1, formula2) #> [1] TRUE"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/extract-methods.html","id":null,"dir":"Reference","previous_headings":"","what":"Subset with brackets — [,dreamletResult,ANY,ANY,ANY-method","title":"Subset with brackets — [,dreamletResult,ANY,ANY,ANY-method","text":"Subset brackets Subset brackets","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/extract-methods.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Subset with brackets — [,dreamletResult,ANY,ANY,ANY-method","text":"","code":"# S4 method for dreamletResult,ANY,ANY,ANY [(x, i)  # S4 method for dreamletProcessedData,ANY,ANY,ANY [(x, i)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/extract-methods.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Subset with brackets — [,dreamletResult,ANY,ANY,ANY-method","text":"x dreamletProcessedData object indeces extract","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/extract-methods.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Subset with brackets — [,dreamletResult,ANY,ANY,ANY-method","text":"entries stored specified index","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/extractData-methods.html","id":null,"dir":"Reference","previous_headings":"","what":"Extract expression and colData — extractData","title":"Extract expression and colData — extractData","text":"Extract expression colData dreamletProcessedData","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/extractData-methods.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Extract expression and colData — extractData","text":"","code":"extractData(x, assay)  # S4 method for dreamletProcessedData,character extractData(x, assay)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/extractData-methods.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Extract expression and colData — extractData","text":"x dreamletProcessedData object assay assay extract","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/extractData-methods.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Extract expression and colData — extractData","text":"data.frame DataFrame merged expression colData","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/extractData-methods.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Extract expression and colData — extractData","text":"","code":"library(muscat) library(SingleCellExperiment)  data(example_sce)  # create pseudobulk for each sample and cell cluster pb <- aggregateToPseudoBulk(example_sce,     assay = \"counts\",        cluster_id = 'cluster_id',     sample_id = 'sample_id',    verbose=FALSE)  # voom-style normalization res.proc = processAssays( pb, ~ group_id) #>   B cells... #> 0.03 secs #>   CD14+ Monocytes... #> 0.03 secs #>   CD4 T cells... #> 0.031 secs #>   CD8 T cells... #> 0.029 secs #>   FCGR3A+ Monocytes... #> 0.031 secs  # Extract data.frame of colData merged with expression. # variables and genes are stored as columns, samples as rows df_merge = extractData( res.proc, \"B cells\")  dim(df_merge) #> [1]   4 634  # first few columns df_merge[, 1:6] #>   Row.names group_id AURKAIP1    SSU72     RER1    RPL22 #> 1   ctrl101     ctrl 7.800105 8.155200 8.351120 8.713690 #> 2   ctrl107     ctrl 8.347624 8.546933 7.499627 8.722019 #> 3   stim101     stim 8.281584 7.940547 7.734097 8.425974 #> 4   stim107     stim 7.788927 8.430473 7.899958 9.027714"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/fitVarPart.html","id":null,"dir":"Reference","previous_headings":"","what":"Variance Partition analysis for each assay — fitVarPart","title":"Variance Partition analysis for each assay — fitVarPart","text":"Perform Variance Partition analysis  assay","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/fitVarPart.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Variance Partition analysis for each assay — fitVarPart","text":"","code":"fitVarPart(   x,   formula,   data = colData(x),   assays = assayNames(x),   quiet = FALSE,   BPPARAM = SerialParam(),   ... )  # S4 method for dreamletProcessedData fitVarPart(   x,   formula,   data = colData(x),   assays = assayNames(x),   quiet = FALSE,   BPPARAM = SerialParam(),   ... )"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/fitVarPart.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Variance Partition analysis for each assay — fitVarPart","text":"x SingleCellExperiment dreamletProcessedData object formula regression formula differential expression analysis data metadata used regression formula assays array assay names include analysis. Defaults assayNames(x) quiet show messages BPPARAM parameters parallel evaluation ... arguments passed dream","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/fitVarPart.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Variance Partition analysis for each assay — fitVarPart","text":"Object class vpDF inheriting DataFrame storing variance fractions gene cell type.","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/fitVarPart.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Variance Partition analysis for each assay — fitVarPart","text":"","code":"library(muscat) library(SingleCellExperiment)  data(example_sce)  # create pseudobulk for each sample and cell cluster pb <- aggregateToPseudoBulk(example_sce,     assay = \"counts\",        cluster_id = 'cluster_id',     sample_id = 'sample_id',    verbose=FALSE)  # voom-style normalization res.proc = processAssays( pb, ~ group_id) #>   B cells... #> 0.021 secs #>   CD14+ Monocytes... #> 0.021 secs #>   CD4 T cells... #> 0.023 secs #>   CD8 T cells... #> 0.022 secs #>   FCGR3A+ Monocytes... #> 0.026 secs  # variance partitioning analysis vp = fitVarPart( res.proc, ~ group_id) #>   B cells... #> Loading required package: Matrix #>  #> Attaching package: ‘Matrix’ #> The following object is masked from ‘package:S4Vectors’: #>  #>     expand #> 1 secs #>   CD14+ Monocytes... #> 1.5 secs #>   CD4 T cells... #> 1.1 secs #>   CD8 T cells... #> 0.44 secs #>   FCGR3A+ Monocytes... #> 1.4 secs #>   # Show variance fractions at the gene-level for each cell type genes = vp$gene[2:4] plotPercentBars(vp[vp$gene %in% genes,])   # Summarize variance fractions genome-wide for each cell type plotVarPart(vp)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/getTreat-methods.html","id":null,"dir":"Reference","previous_headings":"","what":"Test if coefficient is different from a specified value — getTreat,dreamletResult-method","title":"Test if coefficient is different from a specified value — getTreat,dreamletResult-method","text":"Test coefficient different specified value","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/getTreat-methods.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Test if coefficient is different from a specified value — getTreat,dreamletResult-method","text":"","code":"# S4 method for dreamletResult getTreat(fit, lfc = log2(1.2), coef = NULL, number = 10, sort.by = \"p\")"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/getTreat-methods.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Test if coefficient is different from a specified value — getTreat,dreamletResult-method","text":"fit dreamletResult object lfc minimum log2-fold-change changes considered scientifically meaningful coef coefficient test number number genes return sort.column sort ","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/getTreat-methods.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Test if coefficient is different from a specified value — getTreat,dreamletResult-method","text":"DataFrame storing hypothesis test gene cell type","code":""},{"path":[]},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/getTreat-methods.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Test if coefficient is different from a specified value — getTreat,dreamletResult-method","text":"","code":"library(muscat) library(SingleCellExperiment)  data(example_sce)  # create pseudobulk for each sample and cell cluster pb <- aggregateToPseudoBulk(example_sce,     assay = \"counts\",        cluster_id = 'cluster_id',     sample_id = 'sample_id',    verbose=FALSE)  # voom-style normalization res.proc = processAssays( pb, ~ group_id) #>   B cells... #> 0.026 secs #>   CD14+ Monocytes... #> 0.023 secs #>   CD4 T cells... #> 0.025 secs #>   CD8 T cells... #> 0.022 secs #>   FCGR3A+ Monocytes... #> 0.024 secs  # Differential expression analysis within each assay, # evaluated on the voom normalized data  res.dl = dreamlet( res.proc, ~ group_id) #>   B cells... #> 0.063 secs #>   CD14+ Monocytes... #> 0.092 secs #>   CD4 T cells... #> 0.074 secs #>   CD8 T cells... #> 0.041 secs #>   FCGR3A+ Monocytes... #> 0.094 secs #>   # show coefficients estimated for each cell type coefNames(res.dl) #> [1] \"(Intercept)\"  \"group_idstim\"  # extract results using limma-style syntax # combines all cell types together # adj.P.Val gives study-wide FDR getTreat(res.dl, coef=\"group_idstim\", number=3) #> DataFrame with 3 rows and 7 columns #>         assay     logFC   AveExpr         t     P.Value   adj.P.Val         B #>   <character> <numeric> <numeric> <numeric>   <numeric>   <numeric> <numeric> #> 1 CD8 T cells   3.72806   10.9147   15.6147 5.76626e-30 2.02338e-26   62.5196 #> 2     B cells   3.59771   11.5794   15.6095 3.75905e-19 6.59525e-16   35.4471 #> 3 CD4 T cells   5.50055   10.1672   20.8537 3.85685e-15 4.51123e-12   24.3335"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/metadata-dreamletProcessedData-method.html","id":null,"dir":"Reference","previous_headings":"","what":"Extract metadata from dreamletProcessedData — metadata,dreamletProcessedData-method","title":"Extract metadata from dreamletProcessedData — metadata,dreamletProcessedData-method","text":"Extract metadata dreamletProcessedData","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/metadata-dreamletProcessedData-method.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Extract metadata from dreamletProcessedData — metadata,dreamletProcessedData-method","text":"","code":"# S4 method for dreamletProcessedData metadata(x)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/metadata-dreamletProcessedData-method.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Extract metadata from dreamletProcessedData — metadata,dreamletProcessedData-method","text":"x dreamletProcessedData object","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/metadata-dreamletProcessedData-method.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Extract metadata from dreamletProcessedData — metadata,dreamletProcessedData-method","text":"object metadata field","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/outlier.html","id":null,"dir":"Reference","previous_headings":"","what":"Multivariate outlier detection — outlier","title":"Multivariate outlier detection — outlier","text":"Detect multivariante outliers using Mahalanobis distance using mean covariance estimated either standard robust methods.","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/outlier.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Multivariate outlier detection — outlier","text":"","code":"outlier(data, robust = TRUE, ...)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/outlier.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Multivariate outlier detection — outlier","text":"data matrix data robust use robust methods ... arguments passed MASS::cov.rob()","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/outlier.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Multivariate outlier detection — outlier","text":"distance follow chisq distrubtion null standard method mean covariance.  approximate robust method used.  use qchisq(p = 0.999 , df = 2) get cutoff keep 99.9% samples null data 2 columns.","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/outlier.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Multivariate outlier detection — outlier","text":"","code":"data = matrix(rnorm(200), 100, 2)  res = outlier(data)  res[1:4] #> [1] 4.7998866 0.1091616 2.1063447 2.7561817"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotCellComposition.html","id":null,"dir":"Reference","previous_headings":"","what":"Bar plot of cell compositions — plotCellComposition","title":"Bar plot of cell compositions — plotCellComposition","text":"Bar plot cell compositions","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotCellComposition.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Bar plot of cell compositions — plotCellComposition","text":"","code":"plotCellComposition(obj, col, width = NULL)  # S4 method for SingleCellExperiment plotCellComposition(obj, col, width = NULL)  # S4 method for matrix plotCellComposition(obj, col, width = NULL)  # S4 method for data.frame plotCellComposition(obj, col, width = NULL)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotCellComposition.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Bar plot of cell compositions — plotCellComposition","text":"obj matrix [cells] x [samples] SingleCellExperiment aggregateToPseudoBulk col array colors.  missing, use default colors.  names(col) arrayNames(obj), colors assigned assay name#' width specify width bars","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotCellComposition.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Bar plot of cell compositions — plotCellComposition","text":"Barplot showing cell fractions","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotCellComposition.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Bar plot of cell compositions — plotCellComposition","text":"","code":"library(muscat) library(SingleCellExperiment)  data(example_sce)  # create pseudobulk for each sample and cell cluster pb <- aggregateToPseudoBulk(example_sce,     assay = \"counts\",        cluster_id = 'cluster_id',     sample_id = 'sample_id',    verbose=FALSE)  # show cell composition bar plots plotCellComposition(pb)   # extract cell counts df_cellCounts = cellCounts(pb)  # show cell composition bar plots plotCellComposition(df_cellCounts)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotForest-methods.html","id":null,"dir":"Reference","previous_headings":"","what":"Forest plot — plotForest","title":"Forest plot — plotForest","text":"Forest plot","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotForest-methods.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Forest plot — plotForest","text":"","code":"plotForest(x, gene, coef, ...)  # S4 method for dreamletResult plotForest(x, gene, coef, assays = names(x), ylim = NULL)  # S4 method for dreamlet_mash_result plotForest(x, gene, coef, assays = colnames(x$logFC.original), ylim = NULL)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotForest-methods.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Forest plot — plotForest","text":"x result dreamlet gene gene show results coef coefficient test topTable ... arguments assays array assays plot ylim limits y axis","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotForest-methods.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Forest plot — plotForest","text":"Plot showing effect sizes","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotForest-methods.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Forest plot — plotForest","text":"","code":"library(muscat) library(SingleCellExperiment)  data(example_sce)  # create pseudobulk for each sample and cell cluster pb <- aggregateToPseudoBulk(example_sce,     assay = \"counts\",        cluster_id = 'cluster_id',     sample_id = 'sample_id',    verbose=FALSE)  # voom-style normalization res.proc = processAssays( pb, ~ group_id) #>   B cells... #> 0.038 secs #>   CD14+ Monocytes... #> 0.02 secs #>   CD4 T cells... #> 0.023 secs #>   CD8 T cells... #> 0.02 secs #>   FCGR3A+ Monocytes... #> 0.023 secs  # Differential expression analysis within each assay, # evaluated on the voom normalized data  res.dl = dreamlet( res.proc, ~ group_id) #>   B cells... #> 0.059 secs #>   CD14+ Monocytes... #> 0.084 secs #>   CD4 T cells... #> 0.071 secs #>   CD8 T cells... #> 0.037 secs #>   FCGR3A+ Monocytes... #> 0.083 secs #>   # show coefficients estimated for each cell type coefNames(res.dl) #> [1] \"(Intercept)\"  \"group_idstim\"  # Show estimated log fold change with in each cell type plotForest(res.dl, gene = \"ISG20\", coef = \"group_idstim\")"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotGeneHeatmap-methods.html","id":null,"dir":"Reference","previous_headings":"","what":"Heatmap of genes and assays — plotGeneHeatmap","title":"Heatmap of genes and assays — plotGeneHeatmap","text":"Heatmap genes assays","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotGeneHeatmap-methods.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Heatmap of genes and assays — plotGeneHeatmap","text":"","code":"plotGeneHeatmap(   x,   coef,   genes,   assays = assayNames(x),   zmax = NULL,   transpose = FALSE )  # S4 method for dreamletResult plotGeneHeatmap(   x,   coef,   genes,   assays = assayNames(x),   zmax = NULL,   transpose = FALSE )"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotGeneHeatmap-methods.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Heatmap of genes and assays — plotGeneHeatmap","text":"x dreamletResult object coef column number column name specifying coefficient contrast linear model interest. genes array genes include plot assays array assay names include analysis. Defaults assayNames(x) zmax maximum z.std value transpose (default: FALSE) Use `coord_flip()` flip axies","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotGeneHeatmap-methods.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Heatmap of genes and assays — plotGeneHeatmap","text":"Heatmap plot specified genes assays Heatmap plot specified genes assays","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotGeneHeatmap-methods.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Heatmap of genes and assays — plotGeneHeatmap","text":"","code":"library(muscat) library(SingleCellExperiment)  data(example_sce)   # create pseudobulk for each sample and cell cluster pb <- aggregateToPseudoBulk(example_sce,     assay = \"counts\",        cluster_id = 'cluster_id',     sample_id = 'sample_id',    verbose=FALSE)  # voom-style normalization res.proc = processAssays( pb, ~ group_id) #>   B cells... #> 0.022 secs #>   CD14+ Monocytes... #> 0.023 secs #>   CD4 T cells... #> 0.023 secs #>   CD8 T cells... #> 0.021 secs #>   FCGR3A+ Monocytes... #> 0.025 secs  # Differential expression analysis within each assay, # evaluated on the voom normalized data   res.dl = dreamlet( res.proc, ~ group_id) #>   B cells... #> 0.063 secs #>   CD14+ Monocytes... #> 0.11 secs #>   CD4 T cells... #> 0.065 secs #>   CD8 T cells... #> 0.034 secs #>   FCGR3A+ Monocytes... #> 0.075 secs #>   # Heatmap for specified subset of genes plotGeneHeatmap( res.dl, coef=\"group_idstim\", genes=rownames(pb)[1:15]) #> Warning: Removed 21 rows containing missing values (`geom_text()`)."},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotHeatmap-methods.html","id":null,"dir":"Reference","previous_headings":"","what":"Plot heatmap — plotHeatmap","title":"Plot heatmap — plotHeatmap","text":"Plot heatmap","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotHeatmap-methods.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Plot heatmap — plotHeatmap","text":"","code":"plotHeatmap(x, genes = rownames(x), color = \"darkblue\", ...)  # S4 method for cellSpecificityValues plotHeatmap(x, genes = rownames(x), color = \"darkblue\", assays = colnames(x))  # S4 method for matrix plotHeatmap(x, genes = rownames(x), color = \"darkblue\", assays = colnames(x))"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotHeatmap-methods.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Plot heatmap — plotHeatmap","text":"x fractions gene genes name genes plot color color heatmap ... arguments assays array assays plot","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotHeatmap-methods.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Plot heatmap — plotHeatmap","text":"heatmap","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotHeatmap-methods.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Plot heatmap — plotHeatmap","text":"","code":"library(muscat) library(SingleCellExperiment)  data(example_sce)  # create pseudobulk for each sample and cell cluster pb <- aggregateToPseudoBulk(example_sce,    assay = \"counts\",       cluster_id = 'cluster_id',    sample_id = 'sample_id',   verbose=FALSE)  # Compute cell type specificity of each gene df = cellTypeSpecificity( pb)  # For each cell type, get most specific gene genes = rownames(df)[apply(df, 2, which.max)]  # heatmap of 5 genes that are most cell type specific dreamlet::plotHeatmap( df, genes = genes)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotPercentBars-methods.html","id":null,"dir":"Reference","previous_headings":"","what":"Bar plot of variance fractions — plotPercentBars,vpDF-method","title":"Bar plot of variance fractions — plotPercentBars,vpDF-method","text":"Bar plot variance fractions subset genes","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotPercentBars-methods.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Bar plot of variance fractions — plotPercentBars,vpDF-method","text":"","code":"# S4 method for vpDF plotPercentBars(   x,   col = c(ggColorHue(ncol(x) - 3), \"grey85\"),   genes = unique(x$gene),   width = NULL,   ncol = 3,   ... )  # S4 method for cellSpecificityValues plotPercentBars(   x,   col = ggColorHue(ncol(x)),   genes = rownames(x),   width = NULL,   ... )"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotPercentBars-methods.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Bar plot of variance fractions — plotPercentBars,vpDF-method","text":"x vpDF object returned fitVarPart() col color bars variable genes name genes plot width specify width bars ncol number columns plot ... arguments","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotPercentBars-methods.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Bar plot of variance fractions — plotPercentBars,vpDF-method","text":"Bar plot showing variance fractions gene","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotPercentBars-methods.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Bar plot of variance fractions — plotPercentBars,vpDF-method","text":"","code":"library(muscat) library(SingleCellExperiment)  data(example_sce)  # create pseudobulk for each sample and cell cluster pb <- aggregateToPseudoBulk(example_sce,     assay = \"counts\",        cluster_id = 'cluster_id',     sample_id = 'sample_id',    verbose=FALSE)  # voom-style normalization res.proc = processAssays( pb, ~ group_id) #>   B cells... #> 0.021 secs #>   CD14+ Monocytes... #> 0.021 secs #>   CD4 T cells... #> 0.023 secs #>   CD8 T cells... #> 0.023 secs #>   FCGR3A+ Monocytes... #> 0.026 secs  # variance partitioning analysis vp = fitVarPart( res.proc, ~ group_id) #>   B cells... #> 0.98 secs #>   CD14+ Monocytes... #> 1.5 secs #>   CD4 T cells... #> 1.1 secs #>   CD8 T cells... #> 0.45 secs #>   FCGR3A+ Monocytes... #> 1.5 secs #>   # Show variance fractions at the gene-level for each cell type plotPercentBars(vp, genes = vp$gene[2:4], ncol=2)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotProjection.html","id":null,"dir":"Reference","previous_headings":"","what":"Plot 2D projection — plotProjection","title":"Plot 2D projection — plotProjection","text":"Plot 2D projection (.e. UMAP, tSNE) millions cells efficiently","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotProjection.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Plot 2D projection — plotProjection","text":"","code":"plotProjection(   sce,   type,   annotation,   pointsize = 0,   pixels = c(512, 512),   legend.position = \"none\",   text = TRUE,   order )"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotProjection.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Plot 2D projection — plotProjection","text":"sce SingleCellExperiment type field reducedDims(sce) plot annotation column colData(sce) annotate cell pointsize Radius rasterized point. Use 0 single pixels(fastest). pixels Vector X Y resolution raster, default c(512,512) legend.position legend.position: position legends (\"none\", \"left\", \"right\", \"bottom\", \"top\", two-element numeric vector) text show annotation text. Default TRUE order specify order levels annotation","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotProjection.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Plot 2D projection — plotProjection","text":"Uses scattermore::geom_scattermore() plot millions points efficiently","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotProjection.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Plot 2D projection — plotProjection","text":"","code":"library(muscat) library(SingleCellExperiment)  data(example_sce)  plotProjection(example_sce, \"TSNE\", 'cluster_id', 1)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotVarPart-methods.html","id":null,"dir":"Reference","previous_headings":"","what":"Violin plot of variance fractions — plotVarPart,DataFrame-method","title":"Violin plot of variance fractions — plotVarPart,DataFrame-method","text":"Violin plot variance fraction gene variable","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotVarPart-methods.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Violin plot of variance fractions — plotVarPart,DataFrame-method","text":"","code":"# S4 method for DataFrame plotVarPart(   obj,   col = c(ggColorHue(base::ncol(obj) - 3), \"grey85\"),   label.angle = 20,   main = \"\",   ylab = \"\",   convertToPercent = TRUE,   ncol = 3,   ... )"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotVarPart-methods.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Violin plot of variance fractions — plotVarPart,DataFrame-method","text":"obj varParFrac object returned fitExtractVarPart extractVarPart col vector colors label.angle angle labels x-axis main title plot ylab text y-axis convertToPercent multiply fractions 100 convert percent values ncol number columns plot ... additional arguments","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotVarPart-methods.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Violin plot of variance fractions — plotVarPart,DataFrame-method","text":"Violin plot showing variance fractions","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotVarPart-methods.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Violin plot of variance fractions — plotVarPart,DataFrame-method","text":"","code":"library(muscat) library(SingleCellExperiment)  data(example_sce)  # create pseudobulk for each sample and cell cluster pb <- aggregateToPseudoBulk(example_sce,     assay = \"counts\",        cluster_id = 'cluster_id',     sample_id = 'sample_id',    verbose=FALSE)  # voom-style normalization res.proc = processAssays( pb, ~ group_id) #>   B cells... #> 0.023 secs #>   CD14+ Monocytes... #> 0.022 secs #>   CD4 T cells... #> 0.024 secs #>   CD8 T cells... #> 0.021 secs #>   FCGR3A+ Monocytes... #> 0.025 secs  # variance partitioning analysis vp = fitVarPart( res.proc, ~ group_id) #>   B cells... #> 0.96 secs #>   CD14+ Monocytes... #> 1.5 secs #>   CD4 T cells... #> 1.1 secs #>   CD8 T cells... #> 0.46 secs #>   FCGR3A+ Monocytes... #> 1.3 secs #>   # Summarize variance fractions genome-wide for each cell type plotVarPart(vp)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotViolin-methods.html","id":null,"dir":"Reference","previous_headings":"","what":"Plot Violins — plotViolin","title":"Plot Violins — plotViolin","text":"Plot Violins","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotViolin-methods.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Plot Violins — plotViolin","text":"","code":"plotViolin(x, ...)  # S4 method for cellSpecificityValues plotViolin(x, assays = colnames(x))"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotViolin-methods.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Plot Violins — plotViolin","text":"x fractions gene ... arguments assays array assays plot","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotViolin-methods.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Plot Violins — plotViolin","text":"Violin plot","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotViolin-methods.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Plot Violins — plotViolin","text":"","code":"library(muscat) library(SingleCellExperiment)  data(example_sce)  # create pseudobulk for each sample and cell cluster pb <- aggregateToPseudoBulk(example_sce,    assay = \"counts\",       cluster_id = 'cluster_id',    sample_id = 'sample_id',   verbose=FALSE)  # Compute cell type specificity of each gene df = cellTypeSpecificity( pb)  # Violin plot of specificity scores for each cell type # Dashed line indicates genes that are equally expressed # across all cell types.  For K cell types, this is 1/K plotViolin(df)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotVolcano-methods.html","id":null,"dir":"Reference","previous_headings":"","what":"Volcano plot for each cell type — plotVolcano","title":"Volcano plot for each cell type — plotVolcano","text":"Volcano plot cell type","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotVolcano-methods.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Volcano plot for each cell type — plotVolcano","text":"","code":"plotVolcano(   x,   coef,   nGenes = 5,   size = 12,   minp = 9.99999999999997e-311,   cutoff = 0.05,   ncol = 3,   ... )  # S4 method for list plotVolcano(   x,   coef,   nGenes = 5,   size = 12,   minp = 9.99999999999997e-311,   cutoff = 0.05,   ncol = 3,   assays = names(x),   ... )  # S4 method for MArrayLM plotVolcano(   x,   coef,   nGenes = 5,   size = 12,   minp = 9.99999999999997e-311,   cutoff = 0.05,   ncol = 3,   ... )  # S4 method for dreamlet_mash_result plotVolcano(   x,   coef,   nGenes = 5,   size = 12,   minp = 1e-16,   cutoff = 0.05,   ncol = 3,   assays = colnames(x$logFC.original),   ... )"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotVolcano-methods.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Volcano plot for each cell type — plotVolcano","text":"x result dreamlet coef coefficient test topTable nGenes number genes highlight volcano plot size text size minp minimum p-value show y-axis cutoff adj.P.Val cutoff distinguish significant non-significant genes ncol number columns plot ... arguments passed facet_wrap(). Useful specifying scales = \"free_y\" assays assays plot","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotVolcano-methods.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Volcano plot for each cell type — plotVolcano","text":"Volcano plot cell type","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotVolcano-methods.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Volcano plot for each cell type — plotVolcano","text":"","code":"library(muscat) library(SingleCellExperiment)  data(example_sce)  # create pseudobulk for each sample and cell cluster pb <- aggregateToPseudoBulk(example_sce,     assay = \"counts\",        cluster_id = 'cluster_id',     sample_id = 'sample_id',    verbose=FALSE)  # voom-style normalization res.proc = processAssays( pb, ~ group_id) #>   B cells... #> 0.021 secs #>   CD14+ Monocytes... #> 0.021 secs #>   CD4 T cells... #> 0.022 secs #>   CD8 T cells... #> 0.021 secs #>   FCGR3A+ Monocytes... #> 0.024 secs  # Differential expression analysis within each assay, # evaluated on the voom normalized data  res.dl = dreamlet( res.proc, ~ group_id) #>   B cells... #> 0.062 secs #>   CD14+ Monocytes... #> 0.084 secs #>   CD4 T cells... #> 0.067 secs #>   CD8 T cells... #> 0.035 secs #>   FCGR3A+ Monocytes... #> 0.11 secs #>   # show coefficients estimated for each cell type coefNames(res.dl) #> [1] \"(Intercept)\"  \"group_idstim\"  # volcano plot for each cell type plotVolcano(res.dl, coef=\"group_idstim\")   # volcano plot for first two cell types plotVolcano(res.dl[1:2], coef=\"group_idstim\") #> Warning: Removed 1 rows containing missing values (`geom_text_repel()`)."},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotVoom-methods.html","id":null,"dir":"Reference","previous_headings":"","what":"Plot voom curves from each cell type — plotVoom","title":"Plot voom curves from each cell type — plotVoom","text":"Plot voom curves cell type","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotVoom-methods.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Plot voom curves from each cell type — plotVoom","text":"","code":"plotVoom(x, ncol = 3, alpha = 0.5, ...)  # S4 method for dreamletProcessedData plotVoom(x, ncol = 3, alpha = 0.5, assays = names(x))  # S4 method for EList plotVoom(x, ncol = 3, alpha = 0.5)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotVoom-methods.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Plot voom curves from each cell type — plotVoom","text":"x dreamletProcessedData ncol number columns plot alpha transparency points ... arguments assays assays plot","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotVoom-methods.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Plot voom curves from each cell type — plotVoom","text":"Plot mean-variance trend","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/plotVoom-methods.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Plot voom curves from each cell type — plotVoom","text":"","code":"library(muscat) library(SingleCellExperiment)  data(example_sce)  # create pseudobulk for each sample and cell cluster pb <- aggregateToPseudoBulk(example_sce,     assay = \"counts\",        cluster_id = 'cluster_id',     sample_id = 'sample_id',    verbose=FALSE)  # voom-style normalization res.proc = processAssays( pb, ~ group_id) #>   B cells... #> 0.022 secs #>   CD14+ Monocytes... #> 0.021 secs #>   CD4 T cells... #> 0.023 secs #>   CD8 T cells... #> 0.021 secs #>   FCGR3A+ Monocytes... #> 0.041 secs  # Show mean-variance trend from voom plotVoom(res.proc)   # plot for first two cell types plotVoom(res.proc[1:2])"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/print-methods.html","id":null,"dir":"Reference","previous_headings":"","what":"Print object — print,dreamletResult-method","title":"Print object — print,dreamletResult-method","text":"Print object Print object","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/print-methods.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Print object — print,dreamletResult-method","text":"","code":"# S4 method for dreamletResult print(x, ...)  # S4 method for dreamletProcessedData print(x, ...)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/print-methods.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Print object — print,dreamletResult-method","text":"x dreamletProcessedData object ... arguments","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/print-methods.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Print object — print,dreamletResult-method","text":"print data stored object","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/processAssays.html","id":null,"dir":"Reference","previous_headings":"","what":"Processing SingleCellExperiment to dreamletProcessedData — processAssays","title":"Processing SingleCellExperiment to dreamletProcessedData — processAssays","text":"raw counts, estimate precision weights using linear mixed model weighting number cells observed sample.  normalized data, weight number cells.","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/processAssays.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Processing SingleCellExperiment to dreamletProcessedData — processAssays","text":"","code":"processAssays(   sceObj,   formula,   assays = assayNames(sceObj),   min.cells = 10,   min.count = 10,   min.samples = 4,   min.prop = 0.4,   isCounts = TRUE,   normalize.method = \"TMM\",   useCountsWeights = TRUE,   quiet = FALSE,   BPPARAM = SerialParam(),   ... )"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/processAssays.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Processing SingleCellExperiment to dreamletProcessedData — processAssays","text":"sceObj SingleCellExperiment object formula regression formula differential expression analysis assays array assay names include analysis. Defaults assayNames(sceObj) min.cells minimum number observed cells sample included analysis min.count minimum number reads gene considered expressed sample.  Passed edgeR::filterByExpr min.samples minimum number samples passing cutoffs cell cluster retained min.prop minimum proportion retained samples non-zero counts gene retained isCounts logical, indicating data raw counts normalize.method normalization method used calcNormFactors useCountsWeights use cell count weights quiet show messages BPPARAM parameters parallel evaluation ... arguments passed dream","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/processAssays.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Processing SingleCellExperiment to dreamletProcessedData — processAssays","text":"Object class dreamletProcessedData storing voom-style normalized expression data","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/processAssays.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Processing SingleCellExperiment to dreamletProcessedData — processAssays","text":"cell cluster, samples least min.cells retained. clusters least min.samples retained samples kept. Genes retained least min.count reads least min.prop fraction samples.  Current values reasonable defaults, since genes pass cutoffs underpowered differential expression analysis increase multiple testing burden.  values min.cells = 5 min.count = 5 also reasonable want include genes analysis. precision weights estimated using residuals fit specified formula.  weights robust changes formula long major variables explaining highest fraction variance included.","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/processAssays.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Processing SingleCellExperiment to dreamletProcessedData — processAssays","text":"","code":"library(muscat) library(SingleCellExperiment)  data(example_sce)  # create pseudobulk for each sample and cell cluster pb <- aggregateToPseudoBulk(example_sce,     assay = \"counts\",        cluster_id = 'cluster_id',     sample_id = 'sample_id',    verbose=FALSE)  # voom-style normalization res.proc = processAssays( pb, ~ group_id) #>   B cells... #> 0.023 secs #>   CD14+ Monocytes... #> 0.022 secs #>   CD4 T cells... #> 0.025 secs #>   CD8 T cells... #> 0.02 secs #>   FCGR3A+ Monocytes... #> 0.023 secs  # Differential expression analysis within each assay, # evaluated on the voom normalized data  res.dl = dreamlet( res.proc, ~ group_id) #>   B cells... #> 0.061 secs #>   CD14+ Monocytes... #> 0.089 secs #>   CD4 T cells... #> 0.083 secs #>   CD8 T cells... #> 0.037 secs #>   FCGR3A+ Monocytes... #> 0.077 secs #>"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/processOneAssay.html","id":null,"dir":"Reference","previous_headings":"","what":"Processing expression data from assay — processOneAssay","title":"Processing expression data from assay — processOneAssay","text":"raw counts, filter genes samples, estimate precision weights using linear mixed model weighting number cells observed sample.  normalized data, weight number cells","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/processOneAssay.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Processing expression data from assay — processOneAssay","text":"","code":"processOneAssay(   y,   formula,   data,   n.cells,   min.cells = 10,   min.count = 10,   min.samples = 4,   min.prop = 0.4,   isCounts = TRUE,   normalize.method = \"TMM\",   useCountsWeights = TRUE,   quiet = TRUE,   BPPARAM = SerialParam(),   ... )"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/processOneAssay.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Processing expression data from assay — processOneAssay","text":"y matrix counts log2 CPM formula regression formula differential expression analysis data metadata used regression formula n.cells array cell count sample min.cells minimum number observed cells sample included analysis min.count minimum number reads gene considered expressed sample.  Passed edgeR::filterByExpr min.samples minimum number samples passing cutoffs cell cluster retained min.prop minimum proportion retained samples non-zero counts isCounts logical, indicating data raw counts normalize.method normalization method used calcNormFactors useCountsWeights use cell count weights quiet show messages BPPARAM parameters parallel evaluation ... arguments passed dream","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/processOneAssay.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Processing expression data from assay — processOneAssay","text":"EList object storing log2 CPM precision weights","code":""},{"path":[]},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/removeConstantTerms.html","id":null,"dir":"Reference","previous_headings":"","what":"Remove constant terms from formula — removeConstantTerms","title":"Remove constant terms from formula — removeConstantTerms","text":"Remove constant terms formula.  Also remove categorical variables max one example per category","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/removeConstantTerms.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Remove constant terms from formula — removeConstantTerms","text":"","code":"removeConstantTerms(formula, data)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/removeConstantTerms.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Remove constant terms from formula — removeConstantTerms","text":"formula original formula data data.frame","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/removeConstantTerms.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Remove constant terms from formula — removeConstantTerms","text":"formula, possibly terms omitted.","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/removeConstantTerms.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Remove constant terms from formula — removeConstantTerms","text":"Adapted MoEClust::drop_constants","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/removeConstantTerms.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Remove constant terms from formula — removeConstantTerms","text":"","code":"# Valid formula removeConstantTerms(~ group + extra, sleep) #> ~group + extra #> <environment: 0x7fd32c44ce50>  # there is no variation in 'group' in this dataset removeConstantTerms(~ group + extra, sleep[1:3,]) #> ~1 + extra #> <environment: 0x7fd32c44ce50>"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/residuals-methods.html","id":null,"dir":"Reference","previous_headings":"","what":"Extract residuls from dreamletResult — residuals,dreamletResult-method","title":"Extract residuls from dreamletResult — residuals,dreamletResult-method","text":"Extract residuls dreamletResult","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/residuals-methods.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Extract residuls from dreamletResult — residuals,dreamletResult-method","text":"","code":"# S4 method for dreamletResult residuals(object, ...)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/residuals-methods.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Extract residuls from dreamletResult — residuals,dreamletResult-method","text":"object dreamletResult object ... arguments","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/residuals-methods.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Extract residuls from dreamletResult — residuals,dreamletResult-method","text":"residuals model fit","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/residuals-methods.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Extract residuls from dreamletResult — residuals,dreamletResult-method","text":"","code":"library(muscat) library(SingleCellExperiment)  data(example_sce)  # create pseudobulk for each sample and cell cluster pb <- aggregateToPseudoBulk(example_sce,     assay = \"counts\",        cluster_id = 'cluster_id',     sample_id = 'sample_id',    verbose=FALSE)  # voom-style normalization res.proc = processAssays( pb, ~ group_id) #>   B cells... #> 0.021 secs #>   CD14+ Monocytes... #> 0.021 secs #>   CD4 T cells... #> 0.022 secs #>   CD8 T cells... #> 0.026 secs #>   FCGR3A+ Monocytes... #> 0.03 secs  # Differential expression analysis within each assay, # evaluated on the voom normalized data  res.dl = dreamlet( res.proc, ~ group_id) #>   B cells... #> 0.077 secs #>   CD14+ Monocytes... #> 0.11 secs #>   CD4 T cells... #> 0.079 secs #>   CD8 T cells... #> 0.039 secs #>   FCGR3A+ Monocytes... #> 0.081 secs #>   # extract residuals for each assay (i.e. cell type) # Return list with entry for each assay with for retained samples and genes resid.lst = residuals(res.dl)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/run_mash.html","id":null,"dir":"Reference","previous_headings":"","what":"Run mash analysis on dreamlet results — run_mash","title":"Run mash analysis on dreamlet results — run_mash","text":"Run mash analysis dreamlet results","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/run_mash.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Run mash analysis on dreamlet results — run_mash","text":"","code":"run_mash(fit, coefList)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/run_mash.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Run mash analysis on dreamlet results — run_mash","text":"fit result dreamlet() coefList coefficient analyzed","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/run_mash.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Run mash analysis on dreamlet results — run_mash","text":"list storing mashr model model original coefficients logFC.original","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/run_mash.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Run mash analysis on dreamlet results — run_mash","text":"Apply mashr analysis (Urbut et al. 2019)  joint set coefficients gene cell type.  mashr Bayesian statistical method borrows strength across tests (.e. genes cell types) learning distribution non-zero effects based obesrved logFC standard errors.  method estimates posterior distributions coefficient based observed value genome-wide emprical distribution. mashr previously applied differential expression GTEx data using multiple tissues set donors (Oliva et al. 2020) . single cell data, given gene often sufficiently expressed cell types.  evaluated subsets cell types, coefficient value NA. Since mashr assumes coefficients standard errors every gene cell type pair, entries missing values set coef = 0, se = 1e6.  output mashr modified set corresponding values NA, avoid nonsensical results downstream.","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/run_mash.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Run mash analysis on dreamlet results — run_mash","text":"Oliva M, Munoz-Aguirre M, Kim-Hellmuth S, Wucher V, Gewirtz AD, Cotter DJ, Parsana P, Kasela S, Balliu B, Vinuela , others (2020). “impact sex gene expression across human tissues.” Science, 369(6509), eaba3066. https://doi.org/10.1126/science.aba3066. Urbut SM, Wang G, Carbonetto P, Stephens M (2019). “Flexible statistical methods estimating testing effects genomic studies multiple conditions.” Nature genetics, 51(1), 187--195. https://doi.org/10.1038/s41588-018-0268-8.","code":""},{"path":[]},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/run_mash.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Run mash analysis on dreamlet results — run_mash","text":"","code":"library(muscat) library(mashr) #> Loading required package: ashr library(SingleCellExperiment)  data(example_sce)  # create pseudobulk for each sample and cell cluster pb <- aggregateToPseudoBulk(example_sce,    assay = \"counts\",       cluster_id = 'cluster_id',    sample_id = 'sample_id',   verbose=FALSE)  # voom-style normalization res.proc = processAssays( pb, ~ group_id) #>   B cells... #> 0.026 secs #>   CD14+ Monocytes... #> 0.025 secs #>   CD4 T cells... #> 0.028 secs #>   CD8 T cells... #> 0.024 secs #>   FCGR3A+ Monocytes... #> 0.034 secs  # Differential expression analysis within each assay, # evaluated on the voom normalized data  res.dl = dreamlet( res.proc, ~ group_id) #>   B cells... #> 0.074 secs #>   CD14+ Monocytes... #> 0.093 secs #>   CD4 T cells... #> 0.087 secs #>   CD8 T cells... #> 0.036 secs #>   FCGR3A+ Monocytes... #> 0.082 secs #>   # run MASH model # This can take 10s of minutes on real data # This small datasets should take ~30s res_mash = run_mash( res.dl, 'group_idstim')  # extract statistics from mashr model # NA values indicate genes not sufficiently expressed # in a given cell type   # original logFC head(res_mash$logFC.original) #>                          B cells CD14+ Monocytes CD4 T cells CD8 T cells #> ABRACL                        NA       0.6176814          NA          NA #> ACOT9                         NA       2.6548818          NA          NA #> ACP5                          NA      -0.2202786          NA          NA #> ACTB                  -0.5591887      -0.9246124 -0.43264268  0.07892874 #> ACTG1_ENSG00000184009 -0.5542913      -0.8377776 -0.02035041  0.90908842 #> ACTR10                        NA       0.6705051          NA          NA #>                       FCGR3A+ Monocytes #> ABRACL                       0.07918305 #> ACOT9                        0.99499233 #> ACP5                        -0.66846812 #> ACTB                        -0.97279604 #> ACTG1_ENSG00000184009       -1.02526737 #> ACTR10                      -0.04216179  # posterior mean for logFC head(get_pm(res_mash$model)) #>                          B cells CD14+ Monocytes CD4 T cells CD8 T cells #> ABRACL                        NA       0.4326607          NA          NA #> ACOT9                         NA       2.5746697          NA          NA #> ACP5                          NA      -0.1069680          NA          NA #> ACTB                  -0.5490782      -0.7378209 -0.45830605  -0.1533177 #> ACTG1_ENSG00000184009 -0.4953417      -0.6816254 -0.08676361   0.4083446 #> ACTR10                        NA       0.4956688          NA          NA #>                       FCGR3A+ Monocytes #> ABRACL                       0.05003316 #> ACOT9                        1.00444289 #> ACP5                        -0.25742760 #> ACTB                        -0.78359870 #> ACTG1_ENSG00000184009       -0.80675043 #> ACTR10                      -0.01062244  # how many gene-by-celltype tests are significant # i.e.  if a gene is significant in 2 celltypes, it is counted twice table(get_lfsr(res_mash$model) < 0.05, useNA=\"ifany\") #>  #> FALSE  TRUE  <NA>  #>  2397  1112  2346   # how many genes are significant in at least one cell type table( apply(get_lfsr(res_mash$model), 1, min, na.rm=TRUE) < 0.05) #>  #> FALSE  TRUE  #>   591   580   # how many genes are significant in each cell type apply(get_lfsr(res_mash$model), 2, function(x) sum(x < 0.05, na.rm=TRUE)) #>           B cells   CD14+ Monocytes       CD4 T cells       CD8 T cells  #>               146               491               147                78  #> FCGR3A+ Monocytes  #>               250   # examine top set of genes # which genes are significant in at least 1 cell type sort(names(get_significant_results(res_mash$model)))[1:10] #>  [1] \"ACTB\"                  \"ACTG1_ENSG00000184009\" \"ARHGDIB\"               #>  [4] \"ATP5L_ENSG00000167283\" \"ATP6V1G1\"              \"B2M\"                   #>  [7] \"BRK1\"                  \"BTF3\"                  \"BTG1\"                  #> [10] \"CALM1\"                  # Lets examine CXCL3 # There is a lot of variation in the raw logFC res_mash$logFC.original[\"ISG20\",] #>           B cells   CD14+ Monocytes       CD4 T cells       CD8 T cells  #>          3.597711          6.122816          3.073100          3.728061  #> FCGR3A+ Monocytes  #>          4.967554   # posterior mean after borrowing across cell type and genes get_pm(res_mash$model)[\"ISG20\",] #>           B cells   CD14+ Monocytes       CD4 T cells       CD8 T cells  #>          3.618020          5.953471          3.094262          3.746164  #> FCGR3A+ Monocytes  #>          4.862674   # gene set analysis using mashr results library(zenith) go.gs = get_GeneOntology(\"CC\", to=\"SYMBOL\") #> Using cached version from 2023-02-27 20:22:49 # valid values for statistic:  # \"tstatistic\", \"abs(tstatistic)\", \"logFC\", \"abs(logFC)\" df_gs = zenith_gsa(res_mash, go.gs)  # Heatmap of results plotZenithResults(df_gs, 2, 1) #> Warning: Removed 8 rows containing missing values (`geom_text()`).   # forest plot based on mashr results plotForest(res_mash, \"ISG20\")   # volcano plot based on mashr results # yaxis uses local false sign rate (lfsr) plotVolcano(res_mash) #> Warning: Removed 22 rows containing missing values (`geom_text_repel()`)."},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/show-methods.html","id":null,"dir":"Reference","previous_headings":"","what":"Show object — show,dreamletResult-method","title":"Show object — show,dreamletResult-method","text":"Show object Show object","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/show-methods.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Show object — show,dreamletResult-method","text":"","code":"# S4 method for dreamletResult show(object)  # S4 method for dreamletProcessedData show(object)"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/show-methods.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Show object — show,dreamletResult-method","text":"object dreamletProcessedData object","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/show-methods.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Show object — show,dreamletResult-method","text":"show data stored object","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/sortCols-method.html","id":null,"dir":"Reference","previous_headings":"","what":"Sort variance partition statistics — sortCols,vpDF-method","title":"Sort variance partition statistics — sortCols,vpDF-method","text":"Sort variance partition statistics","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/sortCols-method.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Sort variance partition statistics — sortCols,vpDF-method","text":"","code":"# S4 method for vpDF sortCols(   x,   FUN = median,   decreasing = TRUE,   last = c(\"Residuals\", \"Measurement.error\"),   ... )"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/sortCols-method.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Sort variance partition statistics — sortCols,vpDF-method","text":"x object returned fitVarPart() FUN function giving summary statistic sort .  Defaults median decreasing logical.  sorting increasing decreasing? last columns placed right, regardless values columns ... arguments sort","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/sortCols-method.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Sort variance partition statistics — sortCols,vpDF-method","text":"data.frame columns sorted mean value, Residuals last column","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/sortCols-method.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Sort variance partition statistics — sortCols,vpDF-method","text":"","code":"library(muscat) library(SingleCellExperiment)  data(example_sce)  # create pseudobulk for each sample and cell cluster pb <- aggregateToPseudoBulk(example_sce,     assay = \"counts\",        cluster_id = 'cluster_id',     sample_id = 'sample_id',    verbose=FALSE)  # voom-style normalization res.proc = processAssays( pb, ~ group_id) #>   B cells... #> 0.027 secs #>   CD14+ Monocytes... #> 0.026 secs #>   CD4 T cells... #> 0.033 secs #>   CD8 T cells... #> 0.031 secs #>   FCGR3A+ Monocytes... #> 0.06 secs  # variance partitioning analysis vp = fitVarPart( res.proc, ~ group_id) #>   B cells... #> 1.2 secs #>   CD14+ Monocytes... #> 1.8 secs #>   CD4 T cells... #> 1.2 secs #>   CD8 T cells... #> 0.65 secs #>   FCGR3A+ Monocytes... #> 1.6 secs #>   # Summarize variance fractions genome-wide for each cell type plotVarPart( sortCols(vp) )"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/tabToMatrix.html","id":null,"dir":"Reference","previous_headings":"","what":"Convert results table to matrix — tabToMatrix","title":"Convert results table to matrix — tabToMatrix","text":"Convert results table matrix","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/tabToMatrix.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Convert results table to matrix — tabToMatrix","text":"","code":"tabToMatrix(tab, col, rn = \"ID\", cn = \"assay\")"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/tabToMatrix.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Convert results table to matrix — tabToMatrix","text":"tab results table topTable() col column extract rn column id storing rownames cn column id storing colnames","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/tabToMatrix.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Convert results table to matrix — tabToMatrix","text":"matrix storing values column col rows defind rn columns defined cn","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/topTable-methods.html","id":null,"dir":"Reference","previous_headings":"","what":"Table of Top Genes from dreamlet fit — topTable,dreamletResult-method","title":"Table of Top Genes from dreamlet fit — topTable,dreamletResult-method","text":"Extract table top-ranked genes dreamlet fit.","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/topTable-methods.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Table of Top Genes from dreamlet fit — topTable,dreamletResult-method","text":"","code":"# S4 method for dreamletResult topTable(   fit,   coef = NULL,   number = 10,   genelist = NULL,   adjust.method = \"BH\",   sort.by = \"P\",   resort.by = NULL,   p.value = 1,   lfc = 0,   confint = FALSE )"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/topTable-methods.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Table of Top Genes from dreamlet fit — topTable,dreamletResult-method","text":"fit dreamletResult object coef coef number number genelist genelist adjust.method adjust.method sort.sort.resort.resort.p.value p.value lfc lfc confint confint","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/topTable-methods.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Table of Top Genes from dreamlet fit — topTable,dreamletResult-method","text":"data.frame storing hypothesis test gene cell type","code":""},{"path":[]},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/topTable-methods.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Table of Top Genes from dreamlet fit — topTable,dreamletResult-method","text":"","code":"library(muscat) library(SingleCellExperiment)  data(example_sce)  # create pseudobulk for each sample and cell cluster pb <- aggregateToPseudoBulk(example_sce,     assay = \"counts\",        cluster_id = 'cluster_id',     sample_id = 'sample_id',    verbose=FALSE)  # voom-style normalization res.proc = processAssays( pb, ~ group_id) #>   B cells... #> 0.028 secs #>   CD14+ Monocytes... #> 0.028 secs #>   CD4 T cells... #> 0.032 secs #>   CD8 T cells... #> 0.028 secs #>   FCGR3A+ Monocytes... #> 0.034 secs  # Differential expression analysis within each assay, # evaluated on the voom normalized data  res.dl = dreamlet( res.proc, ~ group_id) #>   B cells... #> 0.075 secs #>   CD14+ Monocytes... #> 0.11 secs #>   CD4 T cells... #> 0.082 secs #>   CD8 T cells... #> 0.046 secs #>   FCGR3A+ Monocytes... #> 0.1 secs #>   # show coefficients estimated for each cell type coefNames(res.dl) #> [1] \"(Intercept)\"  \"group_idstim\"  # extract results using limma-style syntax # combines all cell types together # adj.P.Val gives study-wide FDR    topTable(res.dl, coef=\"group_idstim\", number=3) #> DataFrame with 3 rows and 9 columns #>         assay          ID     logFC   AveExpr         t     P.Value   adj.P.Val #>   <character> <character> <numeric> <numeric> <numeric>   <numeric>   <numeric> #> 1 CD8 T cells       ISG20   3.72806   10.9147   16.8000 3.90507e-32 1.37029e-28 #> 2     B cells       ISG20   3.59771   11.5794   16.8407 5.01550e-20 8.79970e-17 #> 3 CD4 T cells       ISG15   5.50055   10.1672   21.9010 2.62269e-15 3.06767e-12 #>           B     z.std #>   <numeric> <numeric> #> 1   62.5196   16.8000 #> 2   35.4471   16.8407 #> 3   24.3335   21.9010"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/vpDF-class.html","id":null,"dir":"Reference","previous_headings":"","what":"Class vpDF — vpDF-class","title":"Class vpDF — vpDF-class","text":"Class vpDF stores results gene assay","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/zenith_gsa-methods.html","id":null,"dir":"Reference","previous_headings":"","what":"Perform gene set analysis using zenith — zenith_gsa,dreamletResult,GeneSetCollection-method","title":"Perform gene set analysis using zenith — zenith_gsa,dreamletResult,GeneSetCollection-method","text":"Perform competitive gene set analysis accounting correlation genes.","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/zenith_gsa-methods.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Perform gene set analysis using zenith — zenith_gsa,dreamletResult,GeneSetCollection-method","text":"","code":"# S4 method for dreamletResult,GeneSetCollection zenith_gsa(   fit,   geneSets,   coefs,   use.ranks = FALSE,   n_genes_min = 10,   inter.gene.cor = 0.01,   progressbar = TRUE,   ... )  # S4 method for dreamlet_mash_result,GeneSetCollection zenith_gsa(   fit,   geneSets,   coefs,   use.ranks = FALSE,   n_genes_min = 10,   inter.gene.cor = 0.01,   progressbar = TRUE,   ... )"},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/zenith_gsa-methods.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Perform gene set analysis using zenith — zenith_gsa,dreamletResult,GeneSetCollection-method","text":"fit results dreamlet() geneSets GeneSetCollection coefs coefficients test using topTable(fit, coef=coefs[]) use.ranks rank-based test TRUE parametric test FALSE? default: FALSE n_genes_min minimum number genes geneset inter.gene.cor NA, estimate correlation data.  Otherwise, use specified value progressbar TRUE, show progress bar ... arguments","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/zenith_gsa-methods.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Perform gene set analysis using zenith — zenith_gsa,dreamletResult,GeneSetCollection-method","text":"data.frame results gene set cell type","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/zenith_gsa-methods.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Perform gene set analysis using zenith — zenith_gsa,dreamletResult,GeneSetCollection-method","text":"code adapts widely used camera() analysis (Wu Smyth 2012)  limma package (Ritchie et al. 2015)  case linear (mixed) models used variancePartition::dream().","code":""},{"path":"http://DiseaseNeurogenomics.github.io/dreamlet/reference/zenith_gsa-methods.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Perform gene set analysis using zenith — zenith_gsa,dreamletResult,GeneSetCollection-method","text":"","code":"library(muscat) library(SingleCellExperiment)  data(example_sce)  # create pseudobulk for each sample and cell cluster pb <- aggregateToPseudoBulk(example_sce,     assay = \"counts\",        cluster_id = 'cluster_id',     sample_id = 'sample_id',    verbose=FALSE)  # voom-style normalization res.proc = processAssays( pb, ~ group_id) #>   B cells... #> 0.025 secs #>   CD14+ Monocytes... #> 0.026 secs #>   CD4 T cells... #> 0.028 secs #>   CD8 T cells... #> 0.028 secs #>   FCGR3A+ Monocytes... #> 0.031 secs  # Differential expression analysis within each assay, # evaluated on the voom normalized data  res.dl = dreamlet( res.proc, ~ group_id) #>   B cells... #> 0.085 secs #>   CD14+ Monocytes... #> 0.13 secs #>   CD4 T cells... #> 0.078 secs #>   CD8 T cells... #> 0.046 secs #>   FCGR3A+ Monocytes... #> 0.092 secs #>   # Load Gene Ontology database  # use gene 'SYMBOL', or 'ENSEMBL' id # use get_MSigDB() to load MSigDB library(zenith) go.gs = get_GeneOntology(\"CC\", to=\"SYMBOL\") #> Using cached version from 2023-02-27 20:22:49     # Run zenith gene set analysis on result of dreamlet res_zenith = zenith_gsa(res.dl, go.gs, 'group_idstim', progressbar=FALSE )  # for each cell type select 3 genesets with largest t-statistic # and 1 geneset with the lowest # Grey boxes indicate the gene set could not be evaluted because #    to few genes were represented plotZenithResults(res_zenith, 3, 1) #> Warning: Removed 13 rows containing missing values (`geom_text()`)."}]
