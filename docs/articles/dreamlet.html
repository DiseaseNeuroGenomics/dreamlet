<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dreamlet analysis of single cell RNA-seq • dreamlet</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Dreamlet analysis of single cell RNA-seq">
<meta property="og:description" content="dreamlet">
<meta property="og:image" content="http://gabrielhoffman.github.io/dreamlet/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dreamlet</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.15</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/dreamlet.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/GabrielHoffman/dreamlet/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="dreamlet_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Dreamlet analysis of single cell RNA-seq</h1>
            <h3 class="subtitle">Linear mixed model analysis of pseudobulk</h3>
                        <h4 class="author">Developed by <a href="http://gabrielhoffman.github.io/">Gabriel Hoffman</a>
</h4>
            
            <h4 class="date">Run on 2021-11-03 13:44:59</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/GabrielHoffman/dreamlet/blob/master/vignettes/dreamlet.Rmd"><code>vignettes/dreamlet.Rmd</code></a></small>
      <div class="hidden name"><code>dreamlet.Rmd</code></div>

    </div>

    
        <div class="abstract">
      <p class="abstract">Abstract</p>
      <p>As the scale of single cell/nucleus RNA-seq has increased, so has the complexity of study designs. Analysis of datasets with simple study designs can be performed using linear model as in the <a href="https://bioconductor.org/packages/muscat">muscat package</a>. Yet analysis of datsets with complex study designs such as repeated measures or many technical batches can benefit from linear mixed model analysis to model to correlation structure between samples. Dreamlet extends the previous work of <a href="https://www.nature.com/articles/s41467-020-19894-4">muscat</a> to apply linear mixed models to pseudobulk data. Dreamlet also supports linear models and facilitates application of 1) <a href="https://bioconductor.org/packages/variancePartition">variancePartition</a> to quantify the contribution of multiple variables to expression variation, and 2) <a href="https://github.com/GabrielHoffman/zenith">zenith</a> to perform gene set analysis on the differential expression signatures.</p>
    </div>
    
<!---

cd /Users/gabrielhoffman/workspace/repos/variancePartition/vignettes

# rm -rf dreamlet_cache/

rmarkdown::render("dreamlet.Rmd")


 devtools::reload("/Users/gabrielhoffman/workspace/repos/dreamlet")

devtools::reload("/Users/gabrielhoffman/workspace/repos/zenith")



--->
<p>Analysis of PBMCs from 8 individuals stimulated with interferon-β <a href="https://www.nature.com/articles/nbt.4042">Kang, et al, 2018, Nature Biotech</a>.</p>
<p>Coming soon: Describe pseudobulk, complex study design, variancePartition, and zenith.</p>
<div id="process-single-cell-counts" class="section level1">
<h1 class="hasAnchor">
<a href="#process-single-cell-counts" class="anchor"></a>Process single cell counts</h1>
<div id="preprocess-data" class="section level2">
<h2 class="hasAnchor">
<a href="#preprocess-data" class="anchor"></a>Preprocess data</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/GabrielHoffman/dreamlet">dreamlet</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/HelenaLC/muscat">muscat</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">ExperimentHub</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/">cowplot</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">zenith</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://bioconductor.org/packages/scater/">scater</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/">kableExtra</a></span><span class="op">)</span>

<span class="va">eh</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ExperimentHub/man/ExperimentHub-class.html">ExperimentHub</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">sce</span> <span class="op">&lt;-</span> <span class="va">eh</span><span class="op">[[</span><span class="st">"EH2259"</span><span class="op">]</span><span class="op">]</span>
<span class="va">sce</span> <span class="op">&lt;-</span> <span class="va">sce</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/assays.html">counts</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="op">]</span>
<span class="va">sce</span> <span class="op">&lt;-</span> <span class="va">sce</span><span class="op">[</span>,<span class="fu">colData</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">$</span><span class="va">multiplets</span> <span class="op">==</span> <span class="st">'singlet'</span><span class="op">]</span>

<span class="va">qc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scuttle/man/perCellQCMetrics.html">perCellQCMetrics</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span>

<span class="co"># remove cells with few or many detected genes</span>
<span class="va">ol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scuttle/man/isOutlier.html">isOutlier</a></span><span class="op">(</span>metric <span class="op">=</span> <span class="va">qc</span><span class="op">$</span><span class="va">detected</span>, nmads <span class="op">=</span> <span class="fl">2</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">sce</span> <span class="op">&lt;-</span> <span class="va">sce</span><span class="op">[</span>, <span class="op">!</span><span class="va">ol</span><span class="op">]</span>

<span class="va">sce</span> <span class="op">&lt;-</span> <span class="va">sce</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/assays.html">counts</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">10</span>, <span class="op">]</span>
<span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scuttle/man/librarySizeFactors.html">computeLibraryFactors</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span>
<span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scuttle/man/logNormCounts.html">logNormCounts</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span></code></pre></div>
</div>
<div id="aggregate-to-pseudobulk" class="section level2">
<h2 class="hasAnchor">
<a href="#aggregate-to-pseudobulk" class="anchor"></a>Aggregate to pseudobulk</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sce</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">sce</span><span class="op">$</span><span class="va">stim</span>, <span class="va">sce</span><span class="op">$</span><span class="va">ind</span><span class="op">)</span>
<span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/muscat/man/prepSCE.html">prepSCE</a></span><span class="op">(</span><span class="va">sce</span>, 
    kid <span class="op">=</span> <span class="st">"cell"</span>, <span class="co"># subpopulation assignments</span>
    gid <span class="op">=</span> <span class="st">"stim"</span>,  <span class="co"># group IDs (ctrl/stim)</span>
    sid <span class="op">=</span> <span class="st">"id"</span>,   <span class="co"># sample IDs (ctrl/stim.1234)</span>
    drop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">pb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/aggregateToPseudoBulk.html">aggregateToPseudoBulk</a></span><span class="op">(</span><span class="va">sce</span>,
    assay <span class="op">=</span> <span class="st">"counts"</span>, fun <span class="op">=</span> <span class="st">"sum"</span>,
    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cluster_id"</span>, <span class="st">"sample_id"</span><span class="op">)</span>,
    verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># one 'assay' per subpopulation</span>
<span class="fu">assayNames</span><span class="op">(</span><span class="va">pb</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "B cells"           "CD14+ Monocytes"   "CD4 T cells"      
## [4] "CD8 T cells"       "Dendritic cells"   "FCGR3A+ Monocytes"
## [7] "Megakaryocytes"    "NK cells"</code></pre>
</div>
</div>
<div id="voom-for-pseudobulk" class="section level1">
<h1 class="hasAnchor">
<a href="#voom-for-pseudobulk" class="anchor"></a>Voom for pseudobulk</h1>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Normalize and apply voom</span>
<span class="va">res.proc</span> <span class="op">=</span> <span class="fu"><a href="../reference/processAssays.html">processAssays</a></span><span class="op">(</span> <span class="va">pb</span>, <span class="op">~</span> <span class="va">group_id</span>, min.count<span class="op">=</span><span class="fl">5</span><span class="op">)</span>
  
<span class="fu"><a href="../reference/plotVoom.html">plotVoom</a></span><span class="op">(</span> <span class="va">res.proc</span><span class="op">)</span></code></pre></div>
<p><img src="dreamlet_files/figure-html/dreamlet-1.png" width="768"></p>
</div>
<div id="run-variancepartition-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#run-variancepartition-analysis" class="anchor"></a>Run variancePartition analysis</h1>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vp.lst</span> <span class="op">=</span> <span class="fu"><a href="../reference/fitVarPart.html">fitVarPart</a></span><span class="op">(</span> <span class="va">res.proc</span>, <span class="op">~</span> <span class="va">group_id</span><span class="op">)</span></code></pre></div>
<div id="variancepartition-plots" class="section level2">
<h2 class="hasAnchor">
<a href="#variancepartition-plots" class="anchor"></a>variancePartition plots</h2>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">plotVarPart</span><span class="op">(</span><span class="va">vp.lst</span><span class="op">)</span></code></pre></div>
<p><img src="dreamlet_files/figure-html/plot.fitVarPart-1.png" width="768"></p>
</div>
</div>
<div id="run-dreamlet" class="section level1">
<h1 class="hasAnchor">
<a href="#run-dreamlet" class="anchor"></a>Run dreamlet</h1>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Differential expression analysis within each assay</span>
<span class="va">res.dl</span> <span class="op">=</span> <span class="fu"><a href="../reference/dreamlet.html">dreamlet</a></span><span class="op">(</span> <span class="va">res.proc</span>, <span class="op">~</span> <span class="va">group_id</span><span class="op">)</span></code></pre></div>
<div id="volcano-plot-for-each-cell-type" class="section level2">
<h2 class="hasAnchor">
<a href="#volcano-plot-for-each-cell-type" class="anchor"></a>Volcano plot for each cell type</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotVolcano.html">plotVolcano</a></span><span class="op">(</span> <span class="va">res.dl</span>, coef <span class="op">=</span> <span class="st">'group_idstim'</span> <span class="op">)</span></code></pre></div>
<p><img src="dreamlet_files/figure-html/plotVolcano-1.png" width="768"></p>
</div>
<div id="extract-results" class="section level2">
<h2 class="hasAnchor">
<a href="#extract-results" class="anchor"></a>Extract results</h2>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit</span> <span class="op">=</span> <span class="va">res.dl</span><span class="op">[[</span><span class="st">"B cells"</span><span class="op">]</span><span class="op">]</span>
<span class="fu">topTable</span><span class="op">(</span><span class="va">fit</span>, coef <span class="op">=</span> <span class="st">'group_idstim'</span> <span class="op">)</span></code></pre></div>
<pre><code>##           logFC   AveExpr        t      P.Value    adj.P.Val        B
## ISG15  5.526203 10.240731 29.94809 3.942031e-21 5.704118e-18 38.37168
## ISG20  3.317362 11.421612 28.30217 1.561277e-20 1.129584e-17 37.05904
## LY6E   4.290878  8.744657 21.01998 2.000133e-17 7.584859e-15 29.93200
## UBE2L6 2.719712  9.279037 20.81040 2.537188e-17 7.584859e-15 29.69832
## IRF7   3.726571  8.716599 20.78195 2.620891e-17 7.584859e-15 29.66924
## EPSTI1 3.696210  8.145939 20.57331 3.329155e-17 8.028813e-15 29.41155
## PLSCR1 4.066102  8.309200 19.70214 9.257824e-17 1.913724e-14 28.40669
## DYNLT1 3.101261  7.912137 18.12641 6.543225e-16 1.080168e-13 26.47151
## IFITM2 2.963947  8.769575 18.10590 6.718392e-16 1.080168e-13 26.43400
## SAT1   2.173411  9.695187 17.40672 1.679515e-15 2.430258e-13 25.43741</code></pre>
</div>
<div id="forrest-plot" class="section level2">
<h2 class="hasAnchor">
<a href="#forrest-plot" class="anchor"></a>Forrest plot</h2>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotForrest.html">plotForrest</a></span><span class="op">(</span> <span class="va">res.dl</span>, coef <span class="op">=</span> <span class="st">'group_idstim'</span>, gene <span class="op">=</span> <span class="st">'IRF7'</span><span class="op">)</span></code></pre></div>
<p><img src="dreamlet_files/figure-html/forrest-1.png" width="700"></p>
</div>
</div>
<div id="gene-set-analysis-using-zenith" class="section level1">
<h1 class="hasAnchor">
<a href="#gene-set-analysis-using-zenith" class="anchor"></a>Gene set analysis using zenith</h1>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load Gene Ontology database </span>
<span class="co"># use gene SYMBOL</span>
<span class="va">go.gs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/zenith/man/get_GeneOntology.html">get_GeneOntology</a></span><span class="op">(</span>to<span class="op">=</span><span class="st">"SYMBOL"</span><span class="op">)</span>
   
<span class="co"># Run zenith gene set analysis on result of dreamlet</span>
<span class="va">res_zenith</span> <span class="op">=</span> <span class="fu"><a href="../reference/zenith_gsa.html">zenith_gsa</a></span><span class="op">(</span><span class="va">res.dl</span>, coef <span class="op">=</span> <span class="st">'group_idstim'</span>, <span class="va">go.gs</span><span class="op">)</span>

<span class="co"># examine results</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">res_zenith</span><span class="op">)</span></code></pre></div>
<pre><code>##     assay         coef                                           Geneset NGenes
## 1 B cells group_idstim   GO0048525: negative regulation of viral process     13
## 2 B cells group_idstim          GO0034340: response to type I interferon     17
## 3 B cells group_idstim    GO0060337: type I interferon signaling pathway     17
## 4 B cells group_idstim GO0071357: cellular response to type I interferon     17
## 5 B cells group_idstim              GO0051607: defense response to virus     24
## 6 B cells group_idstim GO0045069: regulation of viral genome replication     15
##   Correlation    delta        se    p.less    p.greater       PValue Direction
## 1  0.09198421 4.747930 0.9790096 0.9998713 0.0001286964 0.0002573928        Up
## 2  0.14781628 4.586323 1.0783235 0.9995984 0.0004015744 0.0008031488        Up
## 3  0.14781628 4.586323 1.0783235 0.9995984 0.0004015744 0.0008031488        Up
## 4  0.14781628 4.586323 1.0783235 0.9995984 0.0004015744 0.0008031488        Up
## 5  0.10665013 3.479750 0.9236076 0.9989600 0.0010399516 0.0020799032        Up
## 6  0.09051218 3.485671 0.9523702 0.9987133 0.0012866836 0.0025733673        Up
##         FDR
## 1 0.1041381
## 2 0.2124638
## 3 0.2124638
## 4 0.2124638
## 5 0.3919335
## 6 0.4480917</code></pre>
<div id="heatmap-of-top-genesets" class="section level2">
<h2 class="hasAnchor">
<a href="#heatmap-of-top-genesets" class="anchor"></a>Heatmap of top genesets</h2>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># for each cell type select 5 genesets with largest t-statistic</span>
<span class="co"># and 1 geneset with the lowest</span>
<span class="fu"><a href="../reference/plotZenithResults.html">plotZenithResults</a></span><span class="op">(</span><span class="va">res_zenith</span>, <span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="dreamlet_files/figure-html/heatmap-1.png" width="480"></p>
<div id="all-gene-sets-with-fdr-5" class="section level3">
<h3 class="hasAnchor">
<a href="#all-gene-sets-with-fdr-5" class="anchor"></a>All gene sets with FDR &lt; 5%</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># get genesets with FDR &lt; 5%</span>
<span class="va">gs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">res_zenith</span><span class="op">$</span><span class="va">Geneset</span><span class="op">[</span><span class="va">res_zenith</span><span class="op">$</span><span class="va">FDR</span> <span class="op">&lt;</span> <span class="fl">0.05</span><span class="op">]</span><span class="op">)</span>

<span class="co"># keep only results of these genesets</span>
<span class="va">df</span> <span class="op">=</span> <span class="va">res_zenith</span><span class="op">[</span><span class="va">res_zenith</span><span class="op">$</span><span class="va">Geneset</span> <span class="op">%in%</span> <span class="va">gs</span>,<span class="op">]</span>

<span class="co"># plot results, but with no limit based on the highest/lowest t-statistic</span>
<span class="fu"><a href="../reference/plotZenithResults.html">plotZenithResults</a></span><span class="op">(</span><span class="va">df</span>, <span class="cn">Inf</span>, <span class="cn">Inf</span><span class="op">)</span></code></pre></div>
<p><img src="dreamlet_files/figure-html/heatmap2-1.png" width="480"></p>
</div>
</div>
</div>
<div id="test-differences-in-cell-composition" class="section level1">
<h1 class="hasAnchor">
<a href="#test-differences-in-cell-composition" class="anchor"></a>Test differences in cell composition</h1>
<p>Compare fraction of each cell type bewteen simulated and unstimulated samples</p>
<p>Plot cell type composition</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotCellComposition.html">plotCellComposition</a></span><span class="op">(</span><span class="va">pb</span><span class="op">)</span>     </code></pre></div>
<p><img src="dreamlet_files/figure-html/plotCellComposition-1.png" width="480"></p>
<p>Perform statistical testss</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/GabrielHoffman/crumblr">crumblr</a></span><span class="op">)</span>

<span class="co"># get transformed counts and precision weights with crumblr</span>
<span class="va">cobj</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/crumblr/man/crumblr.html">crumblr</a></span><span class="op">(</span> <span class="fu"><a href="../reference/cellCounts.html">cellCounts</a></span><span class="op">(</span><span class="va">pb</span><span class="op">)</span> <span class="op">)</span>

<span class="va">fit</span> <span class="op">=</span> <span class="fu">dream</span><span class="op">(</span><span class="va">cobj</span>, <span class="op">~</span> <span class="va">group_id</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu">colData</span><span class="op">(</span><span class="va">pb</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">fit</span> <span class="op">=</span> <span class="fu">eBayes</span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>

<span class="fu">topTable</span><span class="op">(</span><span class="va">fit</span>, coef<span class="op">=</span><span class="st">'group_idstim'</span>, sort.by<span class="op">=</span><span class="st">"none"</span><span class="op">)</span></code></pre></div>
<pre><code>##                         logFC    AveExpr          t   P.Value adj.P.Val
## B cells           -0.09882673  0.5516882 -0.6989167 0.4943409 0.7706781
## CD14+ Monocytes   -0.12323960  1.2698117 -0.9641347 0.3489000 0.7706781
## CD4 T cells       -0.08092309  2.0201947 -0.3882013 0.7028311 0.7706781
## CD8 T cells       -0.14896362  0.0857175 -0.3589998 0.7241489 0.7706781
## Dendritic cells    0.32314289 -2.1849234  1.1280014 0.2754583 0.7706781
## FCGR3A+ Monocytes  0.07153536 -0.2567492  0.3637101 0.7206938 0.7706781
## Megakaryocytes     0.06001827 -1.8655172  0.2963275 0.7706781 0.7706781
## NK cells           0.08379008  0.3797777  0.5846539 0.5666914 0.7706781
##                           B
## B cells           -4.742373
## CD14+ Monocytes   -4.683602
## CD4 T cells       -4.923287
## CD8 T cells       -4.764307
## Dendritic cells   -4.588102
## FCGR3A+ Monocytes -4.734407
## Megakaryocytes    -4.634451
## NK cells          -4.754474</code></pre>
<p>Partition variation in cell type composition</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vp</span> <span class="op">=</span> <span class="fu">fitExtractVarPartModel</span><span class="op">(</span><span class="va">cobj</span>, <span class="op">~</span> <span class="va">group_id</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu">colData</span><span class="op">(</span><span class="va">pb</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="fu">plotPercentBars</span><span class="op">(</span><span class="va">vp</span><span class="op">)</span></code></pre></div>
<p><img src="dreamlet_files/figure-html/ctc.crumblr.cp-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="http://gabrielhoffman.github.io">Gabriel Hoffman</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
